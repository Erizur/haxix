// Generated by HLC 5.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <hxd/fs/ConvertFBX2HMD.h>
extern String s$fbx;
extern hl_type t$vrt_f85eed7;
extern String s$hmd;
void hxd_fs_Convert_new(hxd__fs__Convert,vvirtual*,String);
#include <hxd/fmt/fbx/HMDOut.h>
#include <haxe/ds/StringMap.h>
#include <hxd/fmt/hmd/Data.h>
#include <haxe/io/BytesOutput.h>
#include <hxd/fmt/hmd/Writer.h>
vvirtual* hxd_fmt_fbx_Parser_parse(haxe__io__Bytes);
String Std_string(vdynamic*);
extern String s$2865b0e;
String String___add__(String,String);
extern hl_type t$hxd_fmt_fbx_HMDOut;
void hxd_fmt_fbx_HMDOut_new(hxd__fmt__fbx__HMDOut,String);
extern hl_type t$_dyn;
extern hl_type t$_bool;
extern hl_type t$_i32;
extern hl_type t$haxe_ds_StringMap;
void haxe_ds_StringMap_new(haxe__ds__StringMap);
hl__types__ArrayObj Reflect_fields(vdynamic*);
extern hl_type t$vrt_b840ca7;
vdynamic* Reflect_field(vdynamic*,String);
extern hl_type t$String;
extern String s$Invalid_precision_;
extern String s$_should_be_u8_s8_f16;
#include <hl/natives.h>
void haxe_ds_StringMap_set(haxe__ds__StringMap,String,vdynamic*);
#include <hxd/fmt/fbx/BaseLibrary.h>
void hxd_fmt_fbx_BaseLibrary_load(hxd__fmt__fbx__BaseLibrary,vvirtual*);
extern String s$Anim_;
bool StringTools_startsWith(String,String);
String String_toLowerCase(String);
extern String s$_anim_;
int String_indexOf(String,String,vdynamic*);
hxd__fmt__hmd__Data hxd_fmt_fbx_HMDOut_toHMD(hxd__fmt__fbx__HMDOut,String,bool);
extern hl_type t$haxe_io_BytesOutput;
void haxe_io_BytesOutput_new(haxe__io__BytesOutput);
extern hl_type t$hxd_fmt_hmd_Writer;
#include <haxe/io/Output.h>
void hxd_fmt_hmd_Writer_new(hxd__fmt__hmd__Writer,haxe__io__Output);
void hxd_fmt_hmd_Writer_write(hxd__fmt__hmd__Writer,hxd__fmt__hmd__Data);
haxe__io__Bytes haxe_io_BytesOutput_getBytes(haxe__io__BytesOutput);
void hxd_fs_Convert_save(hxd__fs__Convert,haxe__io__Bytes);

void hxd_fs_ConvertFBX2HMD_new(hxd__fs__ConvertFBX2HMD r0) {
	String r2;
	vvirtual *r3;
	r2 = (String)s$fbx;
	r3 = hl_to_virtual(&t$vrt_f85eed7,(vdynamic*)r2);
	r2 = (String)s$hmd;
	hxd_fs_Convert_new(((hxd__fs__Convert)r0),r3,r2);
	return;
}

void hxd_fs_ConvertFBX2HMD_convert(hxd__fs__ConvertFBX2HMD r0) {
	hxd__fmt__hmd__Data r24;
	String r7, r9, r19, r20;
	hl__types__ArrayObj r14;
	haxe__ds__StringMap r13;
	vvirtual *r3, *r4, *r18;
	hxd__fmt__fbx__HMDOut r10;
	bool r11, r25;
	haxe__io__Bytes r5;
	hxd__fmt__hmd__Writer r27;
	haxe__io__BytesOutput r26;
	vdynamic *r2, *r6, *r8, *r23;
	vbyte *r21, *r22;
	varray *r17;
	int r12, r15, r16;
	hl_trap_ctx trap$0;
	hl_trap(trap$0,r2,label$bada073_2_6);
	r5 = r0->srcBytes;
	r4 = hxd_fmt_fbx_Parser_parse(r5);
	r3 = r4;
	hl_endtrap(trap$0);
	goto label$bada073_2_13;
	label$bada073_2_6:
	r6 = NULL;
	r7 = Std_string(r2);
	r9 = (String)s$2865b0e;
	r7 = String___add__(r7,r9);
	r9 = r0->srcPath;
	r7 = String___add__(r7,r9);
	hl_throw((vdynamic*)r7);
	label$bada073_2_13:
	r10 = (hxd__fmt__fbx__HMDOut)hl_alloc_obj(&t$hxd_fmt_fbx_HMDOut);
	r7 = r0->srcPath;
	hxd_fmt_fbx_HMDOut_new(r10,r7);
	r6 = r0->params;
	if( !r6 ) goto label$bada073_2_132;
	r6 = r0->params;
	if( r6 == NULL ) hl_null_access();
	r6 = (vdynamic*)hl_dyn_getp((vdynamic*)r6,198865137/*normals*/,&t$_dyn);
	r11 = (bool)hl_dyn_casti(&r6,&t$_dyn,&t$_bool);
	if( !r11 ) goto label$bada073_2_25;
	r11 = true;
	r10->generateNormals = r11;
	label$bada073_2_25:
	r6 = r0->params;
	if( r6 == NULL ) hl_null_access();
	r6 = (vdynamic*)hl_dyn_getp((vdynamic*)r6,256630496/*precise*/,&t$_dyn);
	r11 = (bool)hl_dyn_casti(&r6,&t$_dyn,&t$_bool);
	if( !r11 ) goto label$bada073_2_34;
	r11 = true;
	r10->highPrecision = r11;
	r11 = true;
	r10->fourBonesByVertex = r11;
	label$bada073_2_34:
	r6 = r0->params;
	if( r6 == NULL ) hl_null_access();
	r6 = (vdynamic*)hl_dyn_getp((vdynamic*)r6,18132218/*maxBones*/,&t$_dyn);
	if( !r6 ) goto label$bada073_2_43;
	r6 = r0->params;
	if( r6 == NULL ) hl_null_access();
	r6 = (vdynamic*)hl_dyn_getp((vdynamic*)r6,18132218/*maxBones*/,&t$_dyn);
	r12 = (int)hl_dyn_casti(&r6,&t$_dyn,&t$_i32);
	r10->maxBonesPerSkin = r12;
	label$bada073_2_43:
	r6 = r0->params;
	if( r6 == NULL ) hl_null_access();
	r6 = (vdynamic*)hl_dyn_getp((vdynamic*)r6,421236883/*tangents*/,&t$_dyn);
	if( !r6 ) goto label$bada073_2_49;
	r11 = true;
	r10->generateTangents = r11;
	label$bada073_2_49:
	r6 = r0->params;
	if( r6 == NULL ) hl_null_access();
	r6 = (vdynamic*)hl_dyn_getp((vdynamic*)r6,129478246/*lowp*/,&t$_dyn);
	if( !r6 ) goto label$bada073_2_132;
	r6 = r0->params;
	if( r6 == NULL ) hl_null_access();
	r6 = (vdynamic*)hl_dyn_getp((vdynamic*)r6,129478246/*lowp*/,&t$_dyn);
	r13 = (haxe__ds__StringMap)hl_alloc_obj(&t$haxe_ds_StringMap);
	haxe_ds_StringMap_new(r13);
	r10->lowPrecConfig = r13;
	r12 = 0;
	r14 = Reflect_fields(r6);
	label$bada073_2_61:
	if( r14 == NULL ) hl_null_access();
	r16 = r14->length;
	if( r12 >= r16 ) goto label$bada073_2_132;
	r16 = r14->length;
	if( ((unsigned)r12) < ((unsigned)r16) ) goto label$bada073_2_69;
	r7 = NULL;
	goto label$bada073_2_72;
	label$bada073_2_69:
	r17 = r14->array;
	r8 = ((vdynamic**)(r17 + 1))[r12];
	r7 = (String)r8;
	label$bada073_2_72:
	++r12;
	if( r10 == NULL ) hl_null_access();
	r13 = r10->lowPrecConfig;
	if( r13 ) goto label$bada073_2_78;
	r18 = NULL;
	goto label$bada073_2_82;
	label$bada073_2_78:
	r18 = r13->f$1;
	if( r18 ) goto label$bada073_2_82;
	r18 = hl_to_virtual(&t$vrt_b840ca7,(vdynamic*)r13);
	r13->f$1 = r18;
	label$bada073_2_82:
	r8 = Reflect_field(r6,r7);
	r9 = (String)hl_dyn_castp(&r8,&t$_dyn,&t$String);
	if( r9 ) goto label$bada073_2_90;
	r19 = (String)s$Invalid_precision_;
	r19 = String___add__(r19,r9);
	r20 = (String)s$_should_be_u8_s8_f16;
	r19 = String___add__(r19,r20);
	hl_throw((vdynamic*)r19);
	label$bada073_2_90:
	if( !r9 ) goto label$bada073_2_99;
	r15 = r9->length;
	r16 = 3;
	if( r15 != r16 ) goto label$bada073_2_99;
	r21 = r9->bytes;
	r22 = (vbyte*)USTR("f16");
	r15 = hl_string_compare(r21,r22,r15);
	r16 = 0;
	if( r15 == r16 ) goto label$bada073_2_122;
	label$bada073_2_99:
	if( !r9 ) goto label$bada073_2_108;
	r15 = r9->length;
	r16 = 2;
	if( r15 != r16 ) goto label$bada073_2_108;
	r21 = r9->bytes;
	r22 = (vbyte*)USTR("s8");
	r15 = hl_string_compare(r21,r22,r15);
	r16 = 0;
	if( r15 == r16 ) goto label$bada073_2_124;
	label$bada073_2_108:
	if( !r9 ) goto label$bada073_2_117;
	r15 = r9->length;
	r16 = 2;
	if( r15 != r16 ) goto label$bada073_2_117;
	r21 = r9->bytes;
	r22 = (vbyte*)USTR("u8");
	r15 = hl_string_compare(r21,r22,r15);
	r16 = 0;
	if( r15 == r16 ) goto label$bada073_2_126;
	label$bada073_2_117:
	r19 = (String)s$Invalid_precision_;
	r19 = String___add__(r19,r9);
	r20 = (String)s$_should_be_u8_s8_f16;
	r19 = String___add__(r19,r20);
	hl_throw((vdynamic*)r19);
	label$bada073_2_122:
	r16 = 1;
	goto label$bada073_2_127;
	label$bada073_2_124:
	r16 = 3;
	goto label$bada073_2_127;
	label$bada073_2_126:
	r16 = 2;
	label$bada073_2_127:
	r13 = (haxe__ds__StringMap)hl_dyn_castp(&r18,&t$vrt_b840ca7,&t$haxe_ds_StringMap);
	if( r13 == NULL ) hl_null_access();
	r23 = hl_alloc_dynamic(&t$_i32);
	r23->v.i = r16;
	haxe_ds_StringMap_set(r13,r7,((vdynamic*)r23));
	goto label$bada073_2_61;
	label$bada073_2_132:
	if( r10 == NULL ) hl_null_access();
	hxd_fmt_fbx_BaseLibrary_load(((hxd__fmt__fbx__BaseLibrary)r10),r3);
	r7 = r0->originalFilename;
	r9 = (String)s$Anim_;
	r11 = StringTools_startsWith(r7,r9);
	if( r11 ) goto label$bada073_2_149;
	r7 = r0->originalFilename;
	if( r7 == NULL ) hl_null_access();
	r7 = String_toLowerCase(r7);
	if( r7 == NULL ) hl_null_access();
	r9 = (String)s$_anim_;
	r23 = NULL;
	r12 = String_indexOf(r7,r9,r23);
	r15 = 0;
	if( r15 < r12 ) goto label$bada073_2_149;
	r11 = false;
	goto label$bada073_2_150;
	label$bada073_2_149:
	r11 = true;
	label$bada073_2_150:
	r7 = NULL;
	r25 = !r11;
	r24 = hxd_fmt_fbx_HMDOut_toHMD(r10,r7,r25);
	r26 = (haxe__io__BytesOutput)hl_alloc_obj(&t$haxe_io_BytesOutput);
	haxe_io_BytesOutput_new(r26);
	r27 = (hxd__fmt__hmd__Writer)hl_alloc_obj(&t$hxd_fmt_hmd_Writer);
	hxd_fmt_hmd_Writer_new(r27,((haxe__io__Output)r26));
	hxd_fmt_hmd_Writer_write(r27,r24);
	r5 = haxe_io_BytesOutput_getBytes(r26);
	hxd_fs_Convert_save(((hxd__fs__Convert)r0),r5);
	return;
}

