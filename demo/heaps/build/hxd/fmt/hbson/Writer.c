// Generated by HLC 5.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <hxd/fmt/hbson/Writer.h>
#include <haxe/io/Encoding.h>
extern hl_type t$haxe_ds_StringMap;
void haxe_ds_StringMap_new(haxe__ds__StringMap);
extern String s$HBSON;
void haxe_io_Output_writeString(haxe__io__Output,String,venum*);
void hxd_fmt_hbson_Writer_writeRec(hxd__fmt__hbson__Writer,vdynamic*);
vdynamic* String_charCodeAt(String,int);
#include <haxe/io/Bytes.h>
vdynamic* haxe_ds_StringMap_get(haxe__ds__StringMap,String);
extern hl_type t$_i32;
void haxe_ds_StringMap_set(haxe__ds__StringMap,String,vdynamic*);
void haxe_io_Output_writeInt32(haxe__io__Output,int);
haxe__io__Bytes haxe_io_Bytes_ofString(String,venum*);
void haxe_io_Output_write(haxe__io__Output,haxe__io__Bytes);
#include <_std/ValueType.h>
#include <hl/types/ArrayObj.h>
#include <_std/String.h>
#include <hl/types/ArrayBase.h>
#include <hl/types/ArrayDyn.h>
venum* Type_typeof(vdynamic*);
extern String s$Unsupported_;
String Std_string(vdynamic*);
String String___add__(String,String);
extern hl_type t$_dyn;
void haxe_io_Output_writeDouble(haxe__io__Output,double);
extern hl_type t$_bool;
hl__types__ArrayObj Reflect_fields(vdynamic*);
vdynamic* Reflect_field(vdynamic*,String);
extern $String g$_String;
extern hl_type t$String;
extern hl__types__$ArrayBase g$_hl_types_ArrayBase;
extern hl_type t$hl_types_ArrayDyn;
int hl_types_ArrayDyn_get_length(hl__types__ArrayDyn);

void hxd_fmt_hbson_Writer_new(hxd__fmt__hbson__Writer r0,haxe__io__Output r1) {
	String r5;
	haxe__ds__StringMap r3;
	venum *r6;
	int r2;
	r0->out = r1;
	r2 = 0;
	r0->stringCount = r2;
	r3 = (haxe__ds__StringMap)hl_alloc_obj(&t$haxe_ds_StringMap);
	haxe_ds_StringMap_new(r3);
	r0->stringMap = r3;
	if( r1 == NULL ) hl_null_access();
	r5 = (String)s$HBSON;
	r6 = NULL;
	haxe_io_Output_writeString(r1,r5,r6);
	r2 = 0;
	((void (*)(haxe__io__Output,int))r1->$type->vobj_proto[0])(r1,r2);
	return;
}

void hxd_fmt_hbson_Writer_write(hxd__fmt__hbson__Writer r0,vdynamic* r1) {
	hxd_fmt_hbson_Writer_writeRec(r0,r1);
	return;
}

bool hxd_fmt_hbson_Writer_isAscii(hxd__fmt__hbson__Writer r0,String r1) {
	bool r8;
	vdynamic *r6;
	int r2, r3, r4, r5, r7;
	r2 = 0;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->length;
	label$d58b580_3_3:
	if( r2 >= r3 ) goto label$d58b580_3_15;
	r4 = r2;
	++r2;
	if( r1 == NULL ) hl_null_access();
	r6 = String_charCodeAt(r1,r4);
	r5 = r6 ? r6->v.i : 0;
	r7 = 127;
	if( r7 >= r5 ) goto label$d58b580_3_14;
	r8 = false;
	return r8;
	label$d58b580_3_14:
	goto label$d58b580_3_3;
	label$d58b580_3_15:
	r8 = true;
	return r8;
}

void hxd_fmt_hbson_Writer_writeString(hxd__fmt__hbson__Writer r0,String r1) {
	haxe__ds__StringMap r7;
	venum *r11;
	haxe__io__Bytes r12;
	bool r5;
	haxe__io__Output r10;
	vdynamic *r6, *r8, *r9;
	int r3, r4;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->length;
	r4 = 16;
	if( r4 < r3 ) goto label$d58b580_4_35;
	r5 = hxd_fmt_hbson_Writer_isAscii(r0,r1);
	if( !r5 ) goto label$d58b580_4_35;
	r7 = r0->stringMap;
	if( r7 == NULL ) hl_null_access();
	r6 = haxe_ds_StringMap_get(r7,r1);
	r8 = (vdynamic*)r6;
	if( r8 ) goto label$d58b580_4_30;
	r3 = r0->stringCount;
	r4 = r3;
	++r3;
	r0->stringCount = r3;
	r9 = hl_alloc_dynamic(&t$_i32);
	r9->v.i = r4;
	r7 = r0->stringMap;
	if( r7 == NULL ) hl_null_access();
	haxe_ds_StringMap_set(r7,r1,((vdynamic*)r9));
	r10 = r0->out;
	if( r10 == NULL ) hl_null_access();
	r3 = r1->length;
	r4 = 1073741824;
	r3 = r3 | r4;
	haxe_io_Output_writeInt32(r10,r3);
	r10 = r0->out;
	if( r10 == NULL ) hl_null_access();
	r11 = NULL;
	haxe_io_Output_writeString(r10,r1,r11);
	goto label$d58b580_4_34;
	label$d58b580_4_30:
	r10 = r0->out;
	if( r10 == NULL ) hl_null_access();
	r3 = r8 ? r8->v.i : 0;
	haxe_io_Output_writeInt32(r10,r3);
	label$d58b580_4_34:
	goto label$d58b580_4_47;
	label$d58b580_4_35:
	r11 = NULL;
	r12 = haxe_io_Bytes_ofString(r1,r11);
	r10 = r0->out;
	if( r10 == NULL ) hl_null_access();
	if( r12 == NULL ) hl_null_access();
	r3 = r12->length;
	r4 = 0x80000000;
	r3 = r3 | r4;
	haxe_io_Output_writeInt32(r10,r3);
	r10 = r0->out;
	if( r10 == NULL ) hl_null_access();
	haxe_io_Output_write(r10,r12);
	label$d58b580_4_47:
	return;
}

void hxd_fmt_hbson_Writer_writeRec(hxd__fmt__hbson__Writer r0,vdynamic* r1) {
	$String r16;
	String r6, r7;
	hl__Class r15;
	hl__types__ArrayObj r13;
	venum *r2;
	bool r12;
	haxe__io__Output r8;
	hl__types__ArrayDyn r18;
	hl__types__$ArrayBase r17;
	double r11;
	vdynamic *r3;
	varray *r14;
	int r5, r9, r10;
	r2 = Type_typeof(r1);
	if( r2 == NULL ) hl_null_access();
	r5 = HL__ENUM_INDEX__(r2);
	switch(r5) {
		default:
		case 5:
			r6 = (String)s$Unsupported_;
			r7 = Std_string(r1);
			r6 = String___add__(r6,r7);
			hl_throw((vdynamic*)r6);
		case 0:
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = 6;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			goto label$d58b580_5_163;
		case 1:
			r5 = (int)hl_dyn_casti(&r1,&t$_dyn,&t$_i32);
			r10 = 0;
			if( r5 != r10 ) goto label$d58b580_5_21;
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r9 = 0;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r9);
			goto label$d58b580_5_40;
			label$d58b580_5_21:
			r10 = 0;
			if( r5 < r10 ) goto label$d58b580_5_33;
			r10 = 255;
			if( r10 < r5 ) goto label$d58b580_5_33;
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r9 = 1;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r9);
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			goto label$d58b580_5_40;
			label$d58b580_5_33:
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r9 = 2;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r9);
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			haxe_io_Output_writeInt32(r8,r5);
			label$d58b580_5_40:
			goto label$d58b580_5_163;
		case 2:
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = 3;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r11 = (double)hl_dyn_castd(&r1,&t$_dyn);
			haxe_io_Output_writeDouble(r8,r11);
			goto label$d58b580_5_163;
		case 3:
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r12 = (bool)hl_dyn_casti(&r1,&t$_dyn,&t$_bool);
			if( !r12 ) goto label$d58b580_5_56;
			r5 = 4;
			goto label$d58b580_5_57;
			label$d58b580_5_56:
			r5 = 5;
			label$d58b580_5_57:
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			goto label$d58b580_5_163;
		case 4:
			r13 = Reflect_fields(r1);
			if( r13 == NULL ) hl_null_access();
			r5 = r13->length;
			r9 = 0;
			if( r5 != r9 ) goto label$d58b580_5_69;
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = 7;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			goto label$d58b580_5_89;
			label$d58b580_5_69:
			r5 = r13->length;
			r9 = 256;
			if( r5 >= r9 ) goto label$d58b580_5_81;
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = 8;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = r13->length;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			goto label$d58b580_5_89;
			label$d58b580_5_81:
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = 9;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = r13->length;
			haxe_io_Output_writeInt32(r8,r5);
			label$d58b580_5_89:
			r5 = 0;
			label$d58b580_5_90:
			if( r13 == NULL ) hl_null_access();
			r10 = r13->length;
			if( r5 >= r10 ) goto label$d58b580_5_106;
			r10 = r13->length;
			if( ((unsigned)r5) < ((unsigned)r10) ) goto label$d58b580_5_98;
			r6 = NULL;
			goto label$d58b580_5_101;
			label$d58b580_5_98:
			r14 = r13->array;
			r3 = ((vdynamic**)(r14 + 1))[r5];
			r6 = (String)r3;
			label$d58b580_5_101:
			++r5;
			hxd_fmt_hbson_Writer_writeString(r0,r6);
			r3 = Reflect_field(r1,r6);
			hxd_fmt_hbson_Writer_writeRec(r0,r3);
			goto label$d58b580_5_90;
			label$d58b580_5_106:
			goto label$d58b580_5_163;
		case 6:
			r15 = ((ValueType_TClass*)r2)->p0;
			r16 = ($String)g$_String;
			if( r15 != ((hl__Class)r16) ) goto label$d58b580_5_117;
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = 10;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			r6 = (String)hl_dyn_castp(&r1,&t$_dyn,&t$String);
			hxd_fmt_hbson_Writer_writeString(r0,r6);
			goto label$d58b580_5_163;
			label$d58b580_5_117:
			r17 = (hl__types__$ArrayBase)g$_hl_types_ArrayBase;
			if( r15 != ((hl__Class)r17) ) goto label$d58b580_5_159;
			r18 = (hl__types__ArrayDyn)hl_dyn_castp(&r1,&t$_dyn,&t$hl_types_ArrayDyn);
			if( r18 == NULL ) hl_null_access();
			r5 = hl_types_ArrayDyn_get_length(r18);
			r9 = 0;
			if( r5 != r9 ) goto label$d58b580_5_129;
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = 11;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			goto label$d58b580_5_149;
			label$d58b580_5_129:
			r5 = hl_types_ArrayDyn_get_length(r18);
			r9 = 256;
			if( r5 >= r9 ) goto label$d58b580_5_141;
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = 12;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = hl_types_ArrayDyn_get_length(r18);
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			goto label$d58b580_5_149;
			label$d58b580_5_141:
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = 13;
			((void (*)(haxe__io__Output,int))r8->$type->vobj_proto[0])(r8,r5);
			r8 = r0->out;
			if( r8 == NULL ) hl_null_access();
			r5 = hl_types_ArrayDyn_get_length(r18);
			haxe_io_Output_writeInt32(r8,r5);
			label$d58b580_5_149:
			r5 = 0;
			label$d58b580_5_150:
			if( r18 == NULL ) hl_null_access();
			r10 = hl_types_ArrayDyn_get_length(r18);
			if( r5 >= r10 ) goto label$d58b580_5_158;
			r3 = ((vdynamic* (*)(hl__types__ArrayDyn,int))r18->$type->vobj_proto[0])(r18,r5);
			++r5;
			hxd_fmt_hbson_Writer_writeRec(r0,r3);
			goto label$d58b580_5_150;
			label$d58b580_5_158:
			goto label$d58b580_5_163;
			label$d58b580_5_159:
			r6 = (String)s$Unsupported_;
			r7 = Std_string(r1);
			r6 = String___add__(r6,r7);
			hl_throw((vdynamic*)r6);
	}
	label$d58b580_5_163:
	return;
}

