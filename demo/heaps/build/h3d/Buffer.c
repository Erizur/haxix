// Generated by HLC 5.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <h3d/Buffer.h>
#include <h3d/BufferFlag.h>
#include <h3d/Engine.h>
#include <h3d/impl/MemoryManager.h>
extern h3d__$Buffer g$_h3d_Buffer;
extern h3d__$Engine g$_h3d_Engine;
void h3d_impl_MemoryManager_allocBuffer(h3d__impl__MemoryManager,h3d__Buffer);
void h3d_impl_MemoryManager_freeBuffer(h3d__impl__MemoryManager,h3d__Buffer);
#include <h3d/impl/Driver.h>
extern String s$Invalid_vertices_count;
extern String s$ee85e62;
extern hl_type t$h3d_Buffer;

void h3d_Buffer_new(h3d__Buffer r0,int r1,hxd__BufferFormat r2,hl__types__ArrayObj r3) {
	venum *r9;
	h3d__$Buffer r4;
	h3d__Engine r13;
	h3d__impl__MemoryManager r15;
	h3d__$Engine r14;
	vdynamic *r10;
	varray *r11;
	int r5, r6, r8, r12;
	r4 = (h3d__$Buffer)g$_h3d_Buffer;
	r5 = r4->GUID;
	r6 = r5;
	++r5;
	r4->GUID = r5;
	r0->id = r6;
	r0->vertices = r1;
	r0->format = r2;
	r5 = 0;
	r0->flags = r5;
	if( !r3 ) goto label$e040f64_1_32;
	r5 = 0;
	label$e040f64_1_12:
	if( r3 == NULL ) hl_null_access();
	r8 = r3->length;
	if( r5 >= r8 ) goto label$e040f64_1_32;
	r8 = r3->length;
	if( ((unsigned)r5) < ((unsigned)r8) ) goto label$e040f64_1_20;
	r9 = NULL;
	goto label$e040f64_1_23;
	label$e040f64_1_20:
	r11 = r3->array;
	r10 = ((vdynamic**)(r11 + 1))[r5];
	r9 = (venum*)r10;
	label$e040f64_1_23:
	++r5;
	r6 = r0->flags;
	r8 = 1;
	if( r9 == NULL ) hl_null_access();
	r12 = HL__ENUM_INDEX__(r9);
	r8 = r8 << r12;
	r6 = r6 | r8;
	r0->flags = r6;
	goto label$e040f64_1_12;
	label$e040f64_1_32:
	r14 = (h3d__$Engine)g$_h3d_Engine;
	r13 = r14->CURRENT;
	r0->engine = r13;
	r5 = r0->flags;
	r6 = 2;
	r5 = r5 & r6;
	r6 = 0;
	if( r5 != r6 ) goto label$e040f64_1_45;
	r13 = r0->engine;
	if( r13 == NULL ) hl_null_access();
	r15 = r13->mem;
	if( r15 == NULL ) hl_null_access();
	h3d_impl_MemoryManager_allocBuffer(r15,r0);
	label$e040f64_1_45:
	return;
}

void h3d_Buffer_dispose(h3d__Buffer r0) {
	h3d__Engine r4;
	h3d__impl__MemoryManager r3;
	vdynamic *r2;
	r2 = r0->vbuf;
	if( !r2 ) goto label$e040f64_2_9;
	r4 = r0->engine;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->mem;
	if( r3 == NULL ) hl_null_access();
	h3d_impl_MemoryManager_freeBuffer(r3,r0);
	r2 = NULL;
	r0->vbuf = r2;
	label$e040f64_2_9:
	return;
}

void h3d_Buffer_uploadFloats(h3d__Buffer r0,hl__types__ArrayBytes_hl_F32 r1,int r2,int r3,int* r4) {
	String r9;
	bool r10;
	h3d__Engine r13;
	hxd__BufferFormat r11;
	h3d__impl__Driver r12;
	int r5, r7, r8;
	if( r4 ) goto label$e040f64_3_3;
	r5 = 0;
	goto label$e040f64_3_4;
	label$e040f64_3_3:
	r5 = *r4;
	label$e040f64_3_4:
	r8 = 0;
	if( r5 < r8 ) goto label$e040f64_3_11;
	r8 = 0;
	if( r3 < r8 ) goto label$e040f64_3_11;
	r7 = r5 + r3;
	r8 = r0->vertices;
	if( r8 >= r7 ) goto label$e040f64_3_13;
	label$e040f64_3_11:
	r9 = (String)s$Invalid_vertices_count;
	hl_throw((vdynamic*)r9);
	label$e040f64_3_13:
	r11 = r0->format;
	if( r11 == NULL ) hl_null_access();
	r10 = r11->hasLowPrecision;
	if( !r10 ) goto label$e040f64_3_19;
	r9 = (String)s$ee85e62;
	hl_throw((vdynamic*)r9);
	label$e040f64_3_19:
	r8 = 0;
	if( r3 != r8 ) goto label$e040f64_3_22;
	return;
	label$e040f64_3_22:
	r13 = r0->engine;
	if( r13 == NULL ) hl_null_access();
	r12 = r13->driver;
	if( r12 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__Buffer,int,int,hl__types__ArrayBytes_hl_F32,int))r12->$type->vobj_proto[34])(r12,r0,r5,r3,r1,r2);
	return;
}

h3d__Buffer h3d_Buffer_ofFloats(hl__types__ArrayBytes_hl_F32 r0,hxd__BufferFormat r1,hl__types__ArrayObj r2) {
	h3d__Buffer r7;
	double r3, r5;
	int *r9;
	int r4, r8;
	if( r0 == NULL ) hl_null_access();
	r4 = r0->length;
	r3 = (double)r4;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->stride;
	r5 = (double)r4;
	r3 = r3 / r5;
	r4 = (int)r3;
	r7 = (h3d__Buffer)hl_alloc_obj(&t$h3d_Buffer);
	h3d_Buffer_new(r7,r4,r1,r2);
	r8 = 0;
	r9 = NULL;
	h3d_Buffer_uploadFloats(r7,r0,r8,r4,r9);
	return r7;
}

h3d__Buffer h3d_Buffer_ofSubFloats(hl__types__ArrayBytes_hl_F32 r0,int r1,hxd__BufferFormat r2,hl__types__ArrayObj r3) {
	h3d__Buffer r4;
	int *r7;
	int r5;
	r4 = (h3d__Buffer)hl_alloc_obj(&t$h3d_Buffer);
	h3d_Buffer_new(r4,r1,r2,r3);
	r5 = 0;
	r7 = NULL;
	h3d_Buffer_uploadFloats(r4,r0,r5,r1,r7);
	return r4;
}

