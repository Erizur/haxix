// Generated by HLC 5.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <h3d/pass/Default.h>
extern String s$camera_view;
int hxsl_Globals_allocID(String);
extern String s$camera_zNear;
extern String s$camera_zFar;
extern String s$camera_proj;
extern String s$camera_position;
extern String s$camera_projDiag;
extern String s$camera_projFlip;
extern String s$camera_viewProj;
extern String s$camera_inverseViewProj;
extern String s$global_time;
extern String s$global_pixelSize;
extern String s$global_modelView;
extern String s$global_modelViewInverse;
#include <h3d/MatrixImpl.h>
#include <h3d/Camera.h>
#include <haxe/ds/IntMap.h>
#include <hxsl/Globals.h>
#include <h3d/VectorImpl.h>
#include <h3d/Vector4Impl.h>
#include <h3d/impl/Driver.h>
#include <h3d/Engine.h>
#include <h3d/impl/Feature.h>
#include <h3d/mat/Texture.h>
void haxe_ds_IntMap_set(haxe__ds__IntMap,int,vdynamic*);
extern hl_type t$_f64;
extern hl_type t$h3d_Vector4Impl;
void h3d_Vector4Impl_new(h3d__Vector4Impl,double*,double*,double*,double*);
extern venum* g$e4728a3;
h3d__mat__Texture h3d_Engine_getCurrentTarget(h3d__Engine);
h3d__MatrixImpl h3d_Camera_getInverseViewProj(h3d__Camera);
h3d__VectorImpl h3d_pass_Default_getCurrentPixelSize(h3d__pass__Default);
extern hl_type t$h3d_VectorImpl;
void h3d_VectorImpl_new(h3d__VectorImpl,double*,double*,double*);
#include <hl/types/ArrayObj.h>
#include <hxsl/Output.h>
extern hl_type t$hxsl_Output;
#include <hl/natives.h>
extern String s$output_color;
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
#include <hxsl/ShaderList.h>
#include <hxsl/Shader.h>
hxsl__ShaderList h3d_scene_RenderContext_allocShaderList(h3d__scene__RenderContext,hxsl__Shader,hxsl__ShaderList);
#include <h3d/mat/Pass.h>
#include <h3d/scene/LightSystem.h>
#include <h3d/scene/Object.h>
#include <hxsl/RuntimeShader.h>
#include <hxsl/AllocParam.h>
#include <hxsl/RuntimeShaderData.h>
#include <hxsl/Type.h>
#include <hxsl/AllocGlobal.h>
hxsl__ShaderList h3d_mat_Pass_getShadersRec(h3d__mat__Pass);
hxsl__RuntimeShader h3d_pass_ShaderManager_compileShaders(h3d__pass__ShaderManager,hxsl__ShaderList,bool*);
vdynamic* haxe_ds_IntMap_get(haxe__ds__IntMap,int);
extern String s$Missing_global_value_;
String String___add__(String,String);
extern String s$_for_shader_;
String h3d_pass_ShaderManager_shaderInfo(h3d__pass__ShaderManager,hxsl__ShaderList,String);
extern hl_type t$_dyn;
extern hl_type t$h3d_mat_Texture;
extern String s$Missing_param_value_;
String Std_string(vdynamic*);
extern String s$5058f1a;
void h3d_Engine_selectMaterial(h3d__Engine,h3d__mat__Pass);
#include <h3d/scene/_RenderContext/SharedGlobal.h>
#include <h3d/shader/Buffers.h>
#include <h3d/shader/ShaderBuffers.h>
bool haxe_ds_IntMap_exists(haxe__ds__IntMap,int);
h3d__MatrixImpl h3d_scene_Object_getInvPos(h3d__scene__Object);
void h3d_Engine_selectShader(h3d__Engine,hxsl__RuntimeShader);
extern h3d__pass__$Default g$_h3d_pass_Default;
extern hl_type t$h3d_shader_Buffers;
void h3d_shader_Buffers_new(h3d__shader__Buffers,hxsl__RuntimeShader);
void h3d_shader_ShaderBuffers_grow(h3d__shader__ShaderBuffers,hxsl__RuntimeShaderData);
void h3d_pass_ShaderManager_fillGlobals(h3d__pass__ShaderManager,h3d__shader__Buffers,hxsl__RuntimeShader);
void h3d_Engine_uploadShaderBuffers(h3d__Engine,h3d__shader__Buffers,int);
void h3d_pass_ShaderManager_fillParams(h3d__pass__ShaderManager,h3d__shader__Buffers,hxsl__RuntimeShader,hxsl__ShaderList);
#include <h3d/pass/SortByMaterial.h>
extern hl_type t$h3d_pass_SortByMaterial;
void h3d_pass_SortByMaterial_new(h3d__pass__SortByMaterial);
void h3d_pass_SortByMaterial_sort(h3d__pass__SortByMaterial,h3d__pass__PassList);
extern hl_type t$fun_da122eb;
void h3d_pass_Base_new(h3d__pass__Base,String);
extern hl_type t$h3d_pass_ShaderManager;
void h3d_pass_ShaderManager_new(h3d__pass__ShaderManager,hl__types__ArrayObj);

void h3d_pass_Default_initGlobals(h3d__pass__Default r0) {
	String r2;
	int r1;
	r2 = (String)s$camera_view;
	r1 = hxsl_Globals_allocID(r2);
	r0->cameraView_id = r1;
	r2 = (String)s$camera_zNear;
	r1 = hxsl_Globals_allocID(r2);
	r0->cameraNear_id = r1;
	r2 = (String)s$camera_zFar;
	r1 = hxsl_Globals_allocID(r2);
	r0->cameraFar_id = r1;
	r2 = (String)s$camera_proj;
	r1 = hxsl_Globals_allocID(r2);
	r0->cameraProj_id = r1;
	r2 = (String)s$camera_position;
	r1 = hxsl_Globals_allocID(r2);
	r0->cameraPos_id = r1;
	r2 = (String)s$camera_projDiag;
	r1 = hxsl_Globals_allocID(r2);
	r0->cameraProjDiag_id = r1;
	r2 = (String)s$camera_projFlip;
	r1 = hxsl_Globals_allocID(r2);
	r0->cameraProjFlip_id = r1;
	r2 = (String)s$camera_viewProj;
	r1 = hxsl_Globals_allocID(r2);
	r0->cameraViewProj_id = r1;
	r2 = (String)s$camera_inverseViewProj;
	r1 = hxsl_Globals_allocID(r2);
	r0->cameraInverseViewProj_id = r1;
	r2 = (String)s$global_time;
	r1 = hxsl_Globals_allocID(r2);
	r0->globalTime_id = r1;
	r2 = (String)s$global_pixelSize;
	r1 = hxsl_Globals_allocID(r2);
	r0->pixelSize_id = r1;
	r2 = (String)s$global_modelView;
	r1 = hxsl_Globals_allocID(r2);
	r0->globalModelView_id = r1;
	r2 = (String)s$global_modelViewInverse;
	r1 = hxsl_Globals_allocID(r2);
	r0->globalModelViewInverse_id = r1;
	return;
}

void h3d_pass_Default_setGlobals(h3d__pass__Default r0) {
	h3d__VectorImpl r12;
	venum *r24;
	h3d__pass__ShaderManager r7;
	bool r21;
	haxe__ds__IntMap r5;
	h3d__Camera r2;
	h3d__Engine r23;
	h3d__Vector4Impl r13;
	hxsl__Globals r6;
	double r9, r10, r16, r18, r20;
	h3d__impl__Driver r22;
	double *r14, *r15, *r17, *r19;
	vdynamic *r11;
	h3d__scene__RenderContext r3;
	h3d__MatrixImpl r1;
	h3d__mat__Texture r25;
	int r8;
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->mcam;
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->cameraView_id;
	haxe_ds_IntMap_set(r5,r8,((vdynamic*)r1));
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r9 = r2->zNear;
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->cameraNear_id;
	r11 = hl_alloc_dynamic(&t$_f64);
	r11->v.d = r9;
	haxe_ds_IntMap_set(r5,r8,r11);
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r9 = r2->zFar;
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->cameraFar_id;
	r11 = hl_alloc_dynamic(&t$_f64);
	r11->v.d = r9;
	haxe_ds_IntMap_set(r5,r8,r11);
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->mproj;
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->cameraProj_id;
	haxe_ds_IntMap_set(r5,r8,((vdynamic*)r1));
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r12 = r2->pos;
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->cameraPos_id;
	haxe_ds_IntMap_set(r5,r8,((vdynamic*)r12));
	r13 = (h3d__Vector4Impl)hl_alloc_obj(&t$h3d_Vector4Impl);
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->mproj;
	if( r1 == NULL ) hl_null_access();
	r9 = r1->_11;
	r14 = &r9;
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->mproj;
	if( r1 == NULL ) hl_null_access();
	r10 = r1->_22;
	r15 = &r10;
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->mproj;
	if( r1 == NULL ) hl_null_access();
	r16 = r1->_33;
	r17 = &r16;
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->mproj;
	if( r1 == NULL ) hl_null_access();
	r18 = r1->_44;
	r19 = &r18;
	h3d_Vector4Impl_new(r13,r14,r15,r17,r19);
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->cameraProjDiag_id;
	haxe_ds_IntMap_set(r5,r8,((vdynamic*)r13));
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r23 = r3->engine;
	if( r23 == NULL ) hl_null_access();
	r22 = r23->driver;
	if( r22 == NULL ) hl_null_access();
	r24 = (venum*)g$e4728a3;
	r21 = ((bool (*)(h3d__impl__Driver,venum*))r22->$type->vobj_proto[0])(r22,r24);
	if( !r21 ) goto label$3752213_2_126;
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r23 = r3->engine;
	if( r23 == NULL ) hl_null_access();
	r25 = h3d_Engine_getCurrentTarget(r23);
	if( !r25 ) goto label$3752213_2_126;
	r20 = -1.;
	goto label$3752213_2_127;
	label$3752213_2_126:
	r20 = 1.;
	label$3752213_2_127:
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->cameraProjFlip_id;
	r11 = hl_alloc_dynamic(&t$_f64);
	r11->v.d = r20;
	haxe_ds_IntMap_set(r5,r8,r11);
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->m;
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->cameraViewProj_id;
	haxe_ds_IntMap_set(r5,r8,((vdynamic*)r1));
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->camera;
	if( r2 == NULL ) hl_null_access();
	r1 = h3d_Camera_getInverseViewProj(r2);
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->cameraInverseViewProj_id;
	haxe_ds_IntMap_set(r5,r8,((vdynamic*)r1));
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r20 = r3->time;
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->globalTime_id;
	r11 = hl_alloc_dynamic(&t$_f64);
	r11->v.d = r20;
	haxe_ds_IntMap_set(r5,r8,r11);
	r12 = h3d_pass_Default_getCurrentPixelSize(r0);
	r7 = r0->manager;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r6->map;
	if( r5 == NULL ) hl_null_access();
	r8 = r0->pixelSize_id;
	haxe_ds_IntMap_set(r5,r8,((vdynamic*)r12));
	return;
}

h3d__VectorImpl h3d_pass_Default_getCurrentPixelSize(h3d__pass__Default r0) {
	h3d__VectorImpl r5;
	h3d__Engine r2;
	double r6, r8, r10;
	double *r9, *r11, *r12;
	h3d__scene__RenderContext r3;
	int r7;
	h3d__mat__Texture r1;
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->engine;
	if( r2 == NULL ) hl_null_access();
	r1 = h3d_Engine_getCurrentTarget(r2);
	r5 = (h3d__VectorImpl)hl_alloc_obj(&t$h3d_VectorImpl);
	r6 = 2.;
	if( r1 ) goto label$3752213_3_14;
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->engine;
	if( r2 == NULL ) hl_null_access();
	r7 = r2->width;
	goto label$3752213_3_16;
	label$3752213_3_14:
	if( r1 == NULL ) hl_null_access();
	r7 = r1->width;
	label$3752213_3_16:
	r8 = (double)r7;
	r6 = r6 / r8;
	r9 = &r6;
	r8 = 2.;
	if( r1 ) goto label$3752213_3_27;
	r3 = r0->ctx;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->engine;
	if( r2 == NULL ) hl_null_access();
	r7 = r2->height;
	goto label$3752213_3_29;
	label$3752213_3_27:
	if( r1 == NULL ) hl_null_access();
	r7 = r1->height;
	label$3752213_3_29:
	r10 = (double)r7;
	r8 = r8 / r10;
	r11 = &r8;
	r10 = 0.;
	r12 = &r10;
	h3d_VectorImpl_new(r5,r9,r11,r12);
	return r5;
}

hl__types__ArrayObj h3d_pass_Default_getOutputs(h3d__pass__Default r0) {
	String r6;
	hl__types__ArrayObj r1;
	venum *r5;
	hl_type *r3;
	vdynamic *r7;
	int r4;
	varray *r2;
	r3 = &t$hxsl_Output;
	r4 = 1;
	r2 = hl_alloc_array(r3,r4);
	r6 = (String)s$output_color;
	r7 = NULL;
	r5 = hl_alloc_enum(&t$hxsl_Output,1);
	((hxsl_Output_Value*)r5)->p0 = r6;
	((hxsl_Output_Value*)r5)->p1 = r7;
	r4 = 0;
	((venum**)(r2 + 1))[r4] = r5;
	r1 = hl_types_ArrayObj_alloc(r2);
	return r1;
}

hxsl__ShaderList h3d_pass_Default_processShaders(h3d__pass__Default r0,h3d__pass__PassObject r1,hxsl__ShaderList r2) {
	hxsl__Shader r6;
	hxsl__ShaderList r3, r5;
	h3d__scene__RenderContext r4;
	r4 = r0->ctx;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->extraShaders;
	label$3752213_5_3:
	if( !r3 ) goto label$3752213_5_14;
	r4 = r0->ctx;
	if( r4 == NULL ) hl_null_access();
	if( r3 == NULL ) hl_null_access();
	r6 = r3->s;
	r5 = h3d_scene_RenderContext_allocShaderList(r4,r6,r2);
	r2 = r5;
	r5 = r3->next;
	r3 = r5;
	goto label$3752213_5_3;
	label$3752213_5_14:
	return r2;
}

void h3d_pass_Default_setupShaders(h3d__pass__Default r0,h3d__pass__PassList r1) {
	String r27, r28;
	bool *r17;
	hxsl__RuntimeShader r16;
	venum *r21;
	hxsl__RuntimeShaderData r19;
	h3d__pass__ShaderManager r14;
	bool r2, r10, r32;
	hxsl__AllocGlobal r23;
	haxe__ds__IntMap r25;
	hxsl__Shader r31;
	hxsl__AllocParam r18;
	h3d__mat__Pass r8;
	hxsl__ShaderList r7, r9, r30;
	hxsl__Globals r13;
	h3d__pass__PassObject r4, r5, r6;
	vdynamic *r24, *r26;
	h3d__scene__RenderContext r12;
	h3d__mat__Texture r29;
	int r20, r22;
	h3d__scene__Object r15;
	h3d__scene__LightSystem r11;
	r2 = false;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->current;
	label$3752213_6_3:
	if( !r4 ) goto label$3752213_6_137;
	r5 = r4;
	if( r4 == NULL ) hl_null_access();
	r6 = r4->next;
	r4 = r6;
	r6 = r5;
	if( r5 == NULL ) hl_null_access();
	r8 = r5->pass;
	if( r8 == NULL ) hl_null_access();
	r7 = h3d_mat_Pass_getShadersRec(r8);
	r9 = h3d_pass_Default_processShaders(r0,r5,r7);
	r8 = r5->pass;
	if( r8 == NULL ) hl_null_access();
	r10 = r8->enableLights;
	if( !r10 ) goto label$3752213_6_40;
	r12 = r0->ctx;
	if( r12 == NULL ) hl_null_access();
	r11 = r12->lightSystem;
	if( !r11 ) goto label$3752213_6_40;
	if( r2 ) goto label$3752213_6_34;
	r12 = r0->ctx;
	if( r12 == NULL ) hl_null_access();
	r11 = r12->lightSystem;
	if( r11 == NULL ) hl_null_access();
	r14 = r0->manager;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->globals;
	((void (*)(h3d__scene__LightSystem,hxsl__Globals))r11->$type->vobj_proto[0])(r11,r13);
	r10 = true;
	r2 = r10;
	label$3752213_6_34:
	r12 = r0->ctx;
	if( r12 == NULL ) hl_null_access();
	r11 = r12->lightSystem;
	if( r11 == NULL ) hl_null_access();
	r15 = r5->obj;
	r9 = ((hxsl__ShaderList (*)(h3d__scene__LightSystem,h3d__scene__Object,hxsl__ShaderList))r11->$type->vobj_proto[2])(r11,r15,r9);
	label$3752213_6_40:
	r14 = r0->manager;
	if( r14 == NULL ) hl_null_access();
	r8 = r5->pass;
	if( r8 == NULL ) hl_null_access();
	r10 = r8->batchMode;
	r17 = &r10;
	r16 = h3d_pass_ShaderManager_compileShaders(r14,r9,r17);
	r5->shader = r16;
	r5->shaders = r9;
	r16 = r5->shader;
	if( r16 == NULL ) hl_null_access();
	r19 = r16->fragment;
	if( r19 == NULL ) hl_null_access();
	r18 = r19->textures;
	if( !r18 ) goto label$3752213_6_61;
	if( r18 == NULL ) hl_null_access();
	r21 = r18->type;
	if( r21 == NULL ) hl_null_access();
	r20 = HL__ENUM_INDEX__(r21);
	r22 = 15;
	if( r20 != r22 ) goto label$3752213_6_64;
	label$3752213_6_61:
	r20 = 0;
	r5->texture = r20;
	goto label$3752213_6_136;
	label$3752213_6_64:
	r14 = r0->manager;
	r23 = r18->perObjectGlobal;
	if( !r23 ) goto label$3752213_6_101;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->globals;
	if( r13 == NULL ) hl_null_access();
	r25 = r13->map;
	if( r25 == NULL ) hl_null_access();
	r23 = r18->perObjectGlobal;
	if( r23 == NULL ) hl_null_access();
	r20 = r23->gid;
	r24 = haxe_ds_IntMap_get(r25,r20);
	if( r24 ) goto label$3752213_6_90;
	r27 = (String)s$Missing_global_value_;
	r23 = r18->perObjectGlobal;
	if( r23 == NULL ) hl_null_access();
	r28 = r23->path;
	r27 = String___add__(r27,r28);
	r28 = (String)s$_for_shader_;
	r27 = String___add__(r27,r28);
	r23 = r18->perObjectGlobal;
	if( r23 == NULL ) hl_null_access();
	r28 = r23->path;
	r28 = h3d_pass_ShaderManager_shaderInfo(r14,r9,r28);
	r27 = String___add__(r27,r28);
	hl_throw((vdynamic*)r27);
	label$3752213_6_90:
	r21 = r18->type;
	if( r21 == NULL ) hl_null_access();
	r20 = HL__ENUM_INDEX__(r21);
	r22 = 17;
	if( r20 != r22 ) goto label$3752213_6_98;
	if( r24 == NULL ) hl_null_access();
	r26 = (vdynamic*)hl_dyn_getp((vdynamic*)r24,-18823348/*texture*/,&t$_dyn);
	goto label$3752213_6_99;
	label$3752213_6_98:
	r26 = r24;
	label$3752213_6_99:
	r29 = (h3d__mat__Texture)hl_dyn_castp(&r26,&t$_dyn,&t$h3d_mat_Texture);
	goto label$3752213_6_129;
	label$3752213_6_101:
	r20 = r18->instance;
	label$3752213_6_102:
	--r20;
	r22 = 0;
	if( r22 >= r20 ) goto label$3752213_6_110;
	if( r9 == NULL ) hl_null_access();
	r30 = r9->next;
	r9 = r30;
	goto label$3752213_6_102;
	label$3752213_6_110:
	if( r9 == NULL ) hl_null_access();
	r31 = r9->s;
	if( r31 == NULL ) hl_null_access();
	if( r18 == NULL ) hl_null_access();
	r22 = r18->index;
	r24 = ((vdynamic* (*)(hxsl__Shader,int))r31->$type->vobj_proto[0])(r31,r22);
	if( r24 ) goto label$3752213_6_128;
	r32 = false;
	if( !r32 ) goto label$3752213_6_128;
	r27 = (String)s$Missing_param_value_;
	r31 = r9->s;
	r28 = Std_string(((vdynamic*)r31));
	r27 = String___add__(r27,r28);
	r28 = (String)s$5058f1a;
	r27 = String___add__(r27,r28);
	r28 = r18->name;
	r27 = String___add__(r27,r28);
	hl_throw((vdynamic*)r27);
	label$3752213_6_128:
	r29 = (h3d__mat__Texture)hl_dyn_castp(&r24,&t$_dyn,&t$h3d_mat_Texture);
	label$3752213_6_129:
	if( r6 == NULL ) hl_null_access();
	if( r29 ) goto label$3752213_6_133;
	r20 = 0;
	goto label$3752213_6_135;
	label$3752213_6_133:
	if( r29 == NULL ) hl_null_access();
	r20 = r29->id;
	label$3752213_6_135:
	r6->texture = r20;
	label$3752213_6_136:
	goto label$3752213_6_3;
	label$3752213_6_137:
	return;
}

void h3d_pass_Default_drawObject(h3d__pass__Default r0,h3d__pass__PassObject r1) {
	h3d__Engine r4;
	h3d__mat__Pass r5;
	h3d__scene__RenderContext r2;
	h3d__scene__Object r6;
	r2 = r0->ctx;
	if( r2 == NULL ) hl_null_access();
	r2->drawPass = r1;
	r2 = r0->ctx;
	if( r2 == NULL ) hl_null_access();
	r4 = r2->engine;
	if( r4 == NULL ) hl_null_access();
	if( r1 == NULL ) hl_null_access();
	r5 = r1->pass;
	h3d_Engine_selectMaterial(r4,r5);
	r6 = r1->obj;
	if( r6 == NULL ) hl_null_access();
	r2 = r0->ctx;
	((void (*)(h3d__scene__Object,h3d__scene__RenderContext))r6->$type->vobj_proto[2])(r6,r2);
	return;
}

void h3d_pass_Default_onShaderError(vdynamic* r0,h3d__pass__PassObject r1) {
	hl_throw((vdynamic*)r0);
}

void h3d_pass_Default_draw(h3d__pass__Default r0,h3d__pass__PassList r1,vclosure* r2) {
	hxsl__RuntimeShader r18, r24, r25;
	hl__types__ArrayObj r7;
	hxsl__RuntimeShaderData r32;
	h3d__pass__ShaderManager r15;
	bool r23;
	h3d__shader__ShaderBuffers r31;
	haxe__ds__IntMap r13;
	h3d__pass__$Default r29;
	h3d__Engine r26;
	hxsl__ShaderList r34;
	h3d__mat__Pass r33;
	hxsl__Globals r14;
	h3d__scene___RenderContext__SharedGlobal r11;
	vclosure *r16, *r28;
	h3d__pass__PassObject r4, r19, r20;
	h3d__MatrixImpl r21;
	h3d__scene__RenderContext r8;
	vdynamic *r5, *r27;
	h3d__scene__Object r22;
	h3d__shader__Buffers r17, r30;
	varray *r12;
	int r6, r9, r10;
	hl_trap_ctx trap$0;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->current;
	if( r4 ) goto label$3752213_9_4;
	return;
	label$3752213_9_4:
	r6 = 0;
	r8 = r0->ctx;
	if( r8 == NULL ) hl_null_access();
	r7 = r8->sharedGlobals;
	label$3752213_9_8:
	if( r7 == NULL ) hl_null_access();
	r10 = r7->length;
	if( r6 >= r10 ) goto label$3752213_9_31;
	r10 = r7->length;
	if( ((unsigned)r6) < ((unsigned)r10) ) goto label$3752213_9_16;
	r11 = NULL;
	goto label$3752213_9_19;
	label$3752213_9_16:
	r12 = r7->array;
	r5 = ((vdynamic**)(r12 + 1))[r6];
	r11 = (h3d__scene___RenderContext__SharedGlobal)r5;
	label$3752213_9_19:
	++r6;
	r15 = r0->manager;
	if( r15 == NULL ) hl_null_access();
	r14 = r15->globals;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->map;
	if( r13 == NULL ) hl_null_access();
	if( r11 == NULL ) hl_null_access();
	r9 = r11->gid;
	r5 = r11->value;
	haxe_ds_IntMap_set(r13,r9,r5);
	goto label$3752213_9_8;
	label$3752213_9_31:
	((void (*)(h3d__pass__Default))r0->$type->vobj_proto[2])(r0);
	h3d_pass_Default_setupShaders(r0,r1);
	if( r2 ) goto label$3752213_9_38;
	r16 = r0->defaultSort;
	if( r16 == NULL ) hl_null_access();
	r16->hasValue ? ((void (*)(vdynamic*,h3d__pass__PassList))r16->fun)((vdynamic*)r16->value,r1) : ((void (*)(h3d__pass__PassList))r16->fun)(r1);
	goto label$3752213_9_40;
	label$3752213_9_38:
	if( r2 == NULL ) hl_null_access();
	r2->hasValue ? ((void (*)(vdynamic*,h3d__pass__PassList))r2->fun)((vdynamic*)r2->value,r1) : ((void (*)(h3d__pass__PassList))r2->fun)(r1);
	label$3752213_9_40:
	r8 = r0->ctx;
	if( r8 == NULL ) hl_null_access();
	r15 = r0->manager;
	r8->currentManager = r15;
	r8 = r0->ctx;
	if( r8 == NULL ) hl_null_access();
	r17 = r8->shaderBuffers;
	r18 = NULL;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->current;
	label$3752213_9_50:
	if( !r4 ) goto label$3752213_9_164;
	r19 = r4;
	if( r4 == NULL ) hl_null_access();
	r20 = r4->next;
	r4 = r20;
	if( r19 == NULL ) hl_null_access();
	r22 = r19->obj;
	if( r22 == NULL ) hl_null_access();
	r21 = r22->absPos;
	r15 = r0->manager;
	if( r15 == NULL ) hl_null_access();
	r14 = r15->globals;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->map;
	if( r13 == NULL ) hl_null_access();
	r6 = r0->globalModelView_id;
	haxe_ds_IntMap_set(r13,r6,((vdynamic*)r21));
	r24 = r19->shader;
	if( r24 == NULL ) hl_null_access();
	r13 = r24->globals;
	if( r13 == NULL ) hl_null_access();
	r6 = r0->globalModelViewInverse_id;
	r23 = haxe_ds_IntMap_exists(r13,r6);
	if( !r23 ) goto label$3752213_9_86;
	r22 = r19->obj;
	if( r22 == NULL ) hl_null_access();
	r21 = h3d_scene_Object_getInvPos(r22);
	r15 = r0->manager;
	if( r15 == NULL ) hl_null_access();
	r14 = r15->globals;
	if( r14 == NULL ) hl_null_access();
	r13 = r14->map;
	if( r13 == NULL ) hl_null_access();
	r6 = r0->globalModelViewInverse_id;
	haxe_ds_IntMap_set(r13,r6,((vdynamic*)r21));
	label$3752213_9_86:
	r25 = r19->shader;
	if( r18 == r25 ) goto label$3752213_9_135;
	r24 = r19->shader;
	r18 = r24;
	hl_trap(trap$0,r5,label$3752213_9_99);
	r8 = r0->ctx;
	if( r8 == NULL ) hl_null_access();
	r26 = r8->engine;
	if( r26 == NULL ) hl_null_access();
	r24 = r19->shader;
	h3d_Engine_selectShader(r26,r24);
	hl_endtrap(trap$0);
	goto label$3752213_9_105;
	label$3752213_9_99:
	r27 = NULL;
	r29 = (h3d__pass__$Default)g$_h3d_pass_Default;
	r28 = r29->onShaderError;
	if( r28 == NULL ) hl_null_access();
	r28->hasValue ? ((void (*)(vdynamic*,vdynamic*,h3d__pass__PassObject))r28->fun)((vdynamic*)r28->value,r5,r19) : ((void (*)(vdynamic*,h3d__pass__PassObject))r28->fun)(r5,r19);
	goto label$3752213_9_50;
	label$3752213_9_105:
	if( r17 ) goto label$3752213_9_114;
	r8 = r0->ctx;
	if( r8 == NULL ) hl_null_access();
	r30 = (h3d__shader__Buffers)hl_alloc_obj(&t$h3d_shader_Buffers);
	r24 = r19->shader;
	h3d_shader_Buffers_new(r30,r24);
	r8->shaderBuffers = r30;
	r17 = r30;
	goto label$3752213_9_125;
	label$3752213_9_114:
	r24 = r19->shader;
	if( r17 == NULL ) hl_null_access();
	r31 = r17->vertex;
	if( r31 == NULL ) hl_null_access();
	if( r24 == NULL ) hl_null_access();
	r32 = r24->vertex;
	h3d_shader_ShaderBuffers_grow(r31,r32);
	r31 = r17->fragment;
	if( r31 == NULL ) hl_null_access();
	r32 = r24->fragment;
	h3d_shader_ShaderBuffers_grow(r31,r32);
	label$3752213_9_125:
	r15 = r0->manager;
	if( r15 == NULL ) hl_null_access();
	r24 = r19->shader;
	h3d_pass_ShaderManager_fillGlobals(r15,r17,r24);
	r8 = r0->ctx;
	if( r8 == NULL ) hl_null_access();
	r26 = r8->engine;
	if( r26 == NULL ) hl_null_access();
	r6 = 0;
	h3d_Engine_uploadShaderBuffers(r26,r17,r6);
	label$3752213_9_135:
	r33 = r19->pass;
	if( r33 == NULL ) hl_null_access();
	r23 = r33->dynamicParameters;
	if( r23 ) goto label$3752213_9_162;
	r15 = r0->manager;
	if( r15 == NULL ) hl_null_access();
	r24 = r19->shader;
	r34 = r19->shaders;
	h3d_pass_ShaderManager_fillParams(r15,r17,r24,r34);
	r8 = r0->ctx;
	if( r8 == NULL ) hl_null_access();
	r26 = r8->engine;
	if( r26 == NULL ) hl_null_access();
	r6 = 1;
	h3d_Engine_uploadShaderBuffers(r26,r17,r6);
	r8 = r0->ctx;
	if( r8 == NULL ) hl_null_access();
	r26 = r8->engine;
	if( r26 == NULL ) hl_null_access();
	r6 = 2;
	h3d_Engine_uploadShaderBuffers(r26,r17,r6);
	r8 = r0->ctx;
	if( r8 == NULL ) hl_null_access();
	r26 = r8->engine;
	if( r26 == NULL ) hl_null_access();
	r6 = 3;
	h3d_Engine_uploadShaderBuffers(r26,r17,r6);
	label$3752213_9_162:
	h3d_pass_Default_drawObject(r0,r19);
	goto label$3752213_9_50;
	label$3752213_9_164:
	r8 = r0->ctx;
	if( r8 == NULL ) hl_null_access();
	r6 = 0;
	r8->cachedPos = r6;
	r4 = NULL;
	r8->drawPass = r4;
	return;
}

void h3d_pass_Default_new(h3d__pass__Default r0,String r1) {
	hl__types__ArrayObj r6;
	h3d__pass__ShaderManager r5;
	h3d__pass__SortByMaterial r3;
	vclosure *r2;
	r3 = (h3d__pass__SortByMaterial)hl_alloc_obj(&t$h3d_pass_SortByMaterial);
	h3d_pass_SortByMaterial_new(r3);
	r2 = hl_alloc_closure_ptr(&t$fun_da122eb,h3d_pass_SortByMaterial_sort,r3);
	r0->defaultSort = r2;
	h3d_pass_Base_new(((h3d__pass__Base)r0),r1);
	r5 = (h3d__pass__ShaderManager)hl_alloc_obj(&t$h3d_pass_ShaderManager);
	r6 = ((hl__types__ArrayObj (*)(h3d__pass__Default))r0->$type->vobj_proto[1])(r0);
	h3d_pass_ShaderManager_new(r5,r6);
	r0->manager = r5;
	h3d_pass_Default_initGlobals(r0);
	return;
}

