// Generated by HLC 5.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <h3d/Engine.h>
void h3d_Engine_onCreate(h3d__Engine,bool);
extern hl_type t$fun_d6a95db;
#include <hxsl/RuntimeShader.h>
void h3d_Engine_doFlushTarget(h3d__Engine);
#include <h3d/mat/Pass.h>
#include <h3d/shader/Buffers.h>
#include <h3d/Buffer.h>
#include <h3d/Indexes.h>
bool h3d_Indexes_isDisposed(h3d__Indexes);
extern String s$Invalid_vertices_count;
#include <hxd/MultiFormat.h>
#include <hl/types/ArrayObj.h>
#include <h3d/impl/InstanceBuffer.h>
#include <hxd/impl/Allocator.h>
#include <h3d/mat/TextureFlags.h>
#include <hxd/PixelFormat.h>
#include <h3d/impl/Feature.h>
extern h3d__$Engine g$_h3d_Engine;
int hxd_Window_get_width(hxd__Window);
int hxd_Window_get_height(hxd__Window);
hxd__impl__Allocator hxd_impl_Allocator_get(void);
void hxd_impl_Allocator_onContextLost(hxd__impl__Allocator);
void h3d_impl_MemoryManager_onContextLost(h3d__impl__MemoryManager);
extern hl_type t$h3d_impl_MemoryManager;
void h3d_impl_MemoryManager_new(h3d__impl__MemoryManager,h3d__impl__Driver);
void h3d_impl_MemoryManager_init(h3d__impl__MemoryManager);
extern hl_type t$h3d_mat_Texture;
extern hl_type t$h3d_mat_TextureFlags;
#include <hl/natives.h>
extern venum* g$h3d_mat_TextureFlags_NoAlloc;
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
void h3d_mat_Texture_new(h3d__mat__Texture,int,int,hl__types__ArrayObj,venum*);
extern venum* g$6181a89;
bool h3d_Engine_set_fullScreen(h3d__Engine,bool);
void h3d_Engine_resize(h3d__Engine,int,int);
#include <hxd/SystemValue.h>
extern venum* g$hxd_SystemValue_IsWindowed;
bool hxd_System_getValue(venum*);
int hxd_Window_set_displayMode(hxd__Window,int);
#include <hxd/Timer.h>
extern hxd__$Timer g$_hxd_Timer;
extern hl_type t$_f64;
extern hl_type t$_i32;
void h3d_Engine_clear(h3d__Engine,vdynamic*,vdynamic*,vdynamic*);
extern venum* g$h3d_DepthBinding_ReadWrite;
extern hl_type t$h3d__Engine_TargetTmp;
void h3d__Engine_TargetTmp_new(h3d___Engine__TargetTmp,h3d__mat__Texture,h3d___Engine__TargetTmp,int,int,venum*);
void h3d_Engine_updateNeedFlush(h3d__Engine);
extern venum* g$h3d_DepthBinding_DepthOnly;
extern String s$6e0e621;
extern hl_type t$fun_d333c41;
#include <h3d/impl/GlDriver.h>
extern hl_type t$fun_9e7b219;
extern hl_type t$haxe_ds_ObjectMap;
void haxe_ds_ObjectMap_new(haxe__ds__ObjectMap);
extern hl_type t$haxe_ds_IntMap;
void haxe_ds_IntMap_new(haxe__ds__IntMap);
extern hl_type t$h3d_Vector4Impl;
void h3d_Vector4Impl_new(h3d__Vector4Impl,double*,double*,double*,double*);
hxd__Window hxd_Window_getInstance(void);
double hxd_System_getDefaultFrameRate(void);
void hxd_Window_addResizeEvent(hxd__Window,vclosure*);
extern hl_type t$h3d_impl_GlDriver;
void h3d_impl_GlDriver_new(h3d__impl__GlDriver,int*);

void h3d_Engine_init(h3d__Engine r0) {
	bool *r5;
	bool r4;
	vclosure *r3;
	h3d__impl__Driver r2;
	r2 = r0->driver;
	if( r2 == NULL ) hl_null_access();
	r3 = hl_alloc_closure_ptr(&t$fun_d6a95db,h3d_Engine_onCreate,r0);
	r4 = r0->hardware;
	r4 = !r4;
	r5 = &r4;
	((void (*)(h3d__impl__Driver,vclosure*,bool*))r2->$type->vobj_proto[7])(r2,r3,r5);
	return;
}

void h3d_Engine_selectShader(h3d__Engine r0,hxsl__RuntimeShader r1) {
	bool r3;
	h3d__impl__Driver r4;
	int r5;
	r3 = r0->needFlushTarget;
	if( !r3 ) goto label$5eb80ee_2_3;
	h3d_Engine_doFlushTarget(r0);
	label$5eb80ee_2_3:
	r4 = r0->driver;
	if( r4 == NULL ) hl_null_access();
	r3 = ((bool (*)(h3d__impl__Driver,hxsl__RuntimeShader))r4->$type->vobj_proto[9])(r4,r1);
	if( !r3 ) goto label$5eb80ee_2_10;
	r5 = r0->shaderSwitches;
	++r5;
	r0->shaderSwitches = r5;
	label$5eb80ee_2_10:
	return;
}

void h3d_Engine_selectMaterial(h3d__Engine r0,h3d__mat__Pass r1) {
	h3d__impl__Driver r3;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__mat__Pass))r3->$type->vobj_proto[10])(r3,r1);
	return;
}

void h3d_Engine_uploadShaderBuffers(h3d__Engine r0,h3d__shader__Buffers r1,int r2) {
	h3d__impl__Driver r4;
	r4 = r0->driver;
	if( r4 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__shader__Buffers,int))r4->$type->vobj_proto[11])(r4,r1,r2);
	return;
}

bool h3d_Engine_selectBuffer(h3d__Engine r0,h3d__Buffer r1) {
	bool r4;
	h3d__impl__Driver r5;
	vdynamic *r3;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->vbuf;
	if( r3 ) goto label$5eb80ee_5_5;
	r4 = false;
	return r4;
	label$5eb80ee_5_5:
	r4 = r0->needFlushTarget;
	if( !r4 ) goto label$5eb80ee_5_8;
	h3d_Engine_doFlushTarget(r0);
	label$5eb80ee_5_8:
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__Buffer))r5->$type->vobj_proto[12])(r5,r1);
	r4 = true;
	return r4;
}

void h3d_Engine_renderBuffer(h3d__Engine r0,h3d__Buffer r1,h3d__Indexes r2,int r3,int* r4,int* r5) {
	String r15;
	vvirtual *r17;
	bool r9;
	double r10, r12;
	h3d__impl__Driver r16;
	int r6, r7, r11, r13, r14;
	if( r4 ) goto label$5eb80ee_6_3;
	r6 = 0;
	goto label$5eb80ee_6_4;
	label$5eb80ee_6_3:
	r6 = *r4;
	label$5eb80ee_6_4:
	if( r5 ) goto label$5eb80ee_6_7;
	r7 = -1;
	goto label$5eb80ee_6_8;
	label$5eb80ee_6_7:
	r7 = *r5;
	label$5eb80ee_6_8:
	if( r2 == NULL ) hl_null_access();
	r9 = h3d_Indexes_isDisposed(r2);
	if( !r9 ) goto label$5eb80ee_6_12;
	return;
	label$5eb80ee_6_12:
	if( r1 == NULL ) hl_null_access();
	r11 = r1->vertices;
	r10 = (double)r11;
	r12 = (double)r3;
	r10 = r10 / r12;
	r11 = (int)r10;
	r14 = 0;
	if( r7 >= r14 ) goto label$5eb80ee_6_22;
	r13 = r11 - r6;
	r7 = r13;
	label$5eb80ee_6_22:
	r14 = 0;
	if( r6 < r14 ) goto label$5eb80ee_6_28;
	r14 = 0;
	if( r7 < r14 ) goto label$5eb80ee_6_28;
	r13 = r6 + r7;
	if( r11 >= r13 ) goto label$5eb80ee_6_30;
	label$5eb80ee_6_28:
	r15 = (String)s$Invalid_vertices_count;
	hl_throw((vdynamic*)r15);
	label$5eb80ee_6_30:
	r14 = 0;
	if( r14 >= r7 ) goto label$5eb80ee_6_46;
	r9 = h3d_Engine_selectBuffer(r0,r1);
	if( !r9 ) goto label$5eb80ee_6_46;
	r16 = r0->driver;
	if( r16 == NULL ) hl_null_access();
	r17 = r2->ibuf;
	r14 = 3;
	r13 = r6 * r14;
	((void (*)(h3d__impl__Driver,vvirtual*,int,int))r16->$type->vobj_proto[14])(r16,r17,r13,r7);
	r13 = r0->drawTriangles;
	r13 = r13 + r7;
	r0->drawTriangles = r13;
	r13 = r0->drawCalls;
	++r13;
	r0->drawCalls = r13;
	label$5eb80ee_6_46:
	return;
}

void h3d_Engine_renderIndexed(h3d__Engine r0,h3d__Buffer r1,h3d__Indexes r2,int* r3,int* r4) {
	vvirtual *r15;
	bool r8;
	double r9, r11;
	h3d__impl__Driver r14;
	int r5, r6, r10, r12, r13;
	if( r3 ) goto label$5eb80ee_7_3;
	r5 = 0;
	goto label$5eb80ee_7_4;
	label$5eb80ee_7_3:
	r5 = *r3;
	label$5eb80ee_7_4:
	if( r4 ) goto label$5eb80ee_7_7;
	r6 = -1;
	goto label$5eb80ee_7_8;
	label$5eb80ee_7_7:
	r6 = *r4;
	label$5eb80ee_7_8:
	if( r2 == NULL ) hl_null_access();
	r8 = h3d_Indexes_isDisposed(r2);
	if( !r8 ) goto label$5eb80ee_7_12;
	return;
	label$5eb80ee_7_12:
	r10 = r2->count;
	r9 = (double)r10;
	r11 = 3.;
	r9 = r9 / r11;
	r10 = (int)r9;
	r13 = 0;
	if( r6 >= r13 ) goto label$5eb80ee_7_21;
	r12 = r10 - r5;
	r6 = r12;
	label$5eb80ee_7_21:
	r13 = 0;
	if( r13 >= r6 ) goto label$5eb80ee_7_37;
	r8 = h3d_Engine_selectBuffer(r0,r1);
	if( !r8 ) goto label$5eb80ee_7_37;
	r14 = r0->driver;
	if( r14 == NULL ) hl_null_access();
	r15 = r2->ibuf;
	r13 = 3;
	r12 = r5 * r13;
	((void (*)(h3d__impl__Driver,vvirtual*,int,int))r14->$type->vobj_proto[14])(r14,r15,r12,r6);
	r12 = r0->drawTriangles;
	r12 = r12 + r6;
	r0->drawTriangles = r12;
	r12 = r0->drawCalls;
	++r12;
	r0->drawCalls = r12;
	label$5eb80ee_7_37:
	return;
}

void h3d_Engine_renderMultiBuffers(h3d__Engine r0,hxd__MultiFormat r1,hl__types__ArrayObj r2,h3d__Indexes r3,int* r4,int* r5) {
	vvirtual *r16;
	bool r14;
	double r8, r10;
	h3d__impl__Driver r15;
	int r6, r7, r9, r12, r13;
	if( r4 ) goto label$5eb80ee_8_3;
	r6 = 0;
	goto label$5eb80ee_8_4;
	label$5eb80ee_8_3:
	r6 = *r4;
	label$5eb80ee_8_4:
	if( r5 ) goto label$5eb80ee_8_7;
	r7 = -1;
	goto label$5eb80ee_8_8;
	label$5eb80ee_8_7:
	r7 = *r5;
	label$5eb80ee_8_8:
	if( r3 == NULL ) hl_null_access();
	r9 = r3->count;
	r8 = (double)r9;
	r10 = 3.;
	r8 = r8 / r10;
	r9 = (int)r8;
	r13 = 0;
	if( r13 < r9 ) goto label$5eb80ee_8_17;
	return;
	label$5eb80ee_8_17:
	r14 = r0->needFlushTarget;
	if( !r14 ) goto label$5eb80ee_8_20;
	h3d_Engine_doFlushTarget(r0);
	label$5eb80ee_8_20:
	r15 = r0->driver;
	if( r15 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,hxd__MultiFormat,hl__types__ArrayObj))r15->$type->vobj_proto[13])(r15,r1,r2);
	r14 = h3d_Indexes_isDisposed(r3);
	if( !r14 ) goto label$5eb80ee_8_26;
	return;
	label$5eb80ee_8_26:
	r13 = 0;
	if( r7 >= r13 ) goto label$5eb80ee_8_30;
	r12 = r9 - r6;
	r7 = r12;
	label$5eb80ee_8_30:
	r13 = 0;
	if( r13 >= r7 ) goto label$5eb80ee_8_44;
	r15 = r0->driver;
	if( r15 == NULL ) hl_null_access();
	r16 = r3->ibuf;
	r13 = 3;
	r12 = r6 * r13;
	((void (*)(h3d__impl__Driver,vvirtual*,int,int))r15->$type->vobj_proto[14])(r15,r16,r12,r7);
	r12 = r0->drawTriangles;
	r12 = r12 + r7;
	r0->drawTriangles = r12;
	r12 = r0->drawCalls;
	++r12;
	r0->drawCalls = r12;
	label$5eb80ee_8_44:
	return;
}

void h3d_Engine_renderInstanced(h3d__Engine r0,h3d__Indexes r1,h3d__impl__InstanceBuffer r2) {
	vvirtual *r8;
	bool r4;
	h3d__impl__Driver r7;
	int r5, r6;
	if( r1 == NULL ) hl_null_access();
	r4 = h3d_Indexes_isDisposed(r1);
	if( !r4 ) goto label$5eb80ee_9_4;
	return;
	label$5eb80ee_9_4:
	if( r2 == NULL ) hl_null_access();
	r5 = r2->commandCount;
	r6 = 0;
	if( r6 >= r5 ) goto label$5eb80ee_9_19;
	r7 = r0->driver;
	if( r7 == NULL ) hl_null_access();
	r8 = r1->ibuf;
	((void (*)(h3d__impl__Driver,vvirtual*,h3d__impl__InstanceBuffer))r7->$type->vobj_proto[15])(r7,r8,r2);
	r5 = r0->drawTriangles;
	r6 = r2->triCount;
	r5 = r5 + r6;
	r0->drawTriangles = r5;
	r5 = r0->drawCalls;
	++r5;
	r0->drawCalls = r5;
	label$5eb80ee_9_19:
	return;
}

bool h3d_Engine_set_debug(h3d__Engine r0,bool r1) {
	bool r2;
	h3d__impl__Driver r4;
	r0->debug = r1;
	r4 = r0->driver;
	if( r4 == NULL ) hl_null_access();
	r2 = r0->debug;
	((void (*)(h3d__impl__Driver,bool))r4->$type->vobj_proto[25])(r4,r2);
	return r1;
}

void h3d_Engine_onCreate(h3d__Engine r0,bool r1) {
	hl__types__ArrayObj r12;
	venum *r16, *r17, *r18;
	hl_type *r14;
	bool r4;
	hxd__impl__Allocator r7;
	hxd__Window r6;
	h3d__impl__MemoryManager r8;
	h3d__$Engine r2;
	vclosure *r19;
	h3d__impl__Driver r9;
	varray *r13;
	h3d__mat__Texture r10;
	int r5, r11, r15;
	r2 = (h3d__$Engine)g$_h3d_Engine;
	r2->CURRENT = r0;
	r4 = r0->autoResize;
	if( !r4 ) goto label$5eb80ee_11_12;
	r6 = r0->window;
	if( r6 == NULL ) hl_null_access();
	r5 = hxd_Window_get_width(r6);
	r0->width = r5;
	r6 = r0->window;
	if( r6 == NULL ) hl_null_access();
	r5 = hxd_Window_get_height(r6);
	r0->height = r5;
	label$5eb80ee_11_12:
	if( !r1 ) goto label$5eb80ee_11_20;
	r7 = hxd_impl_Allocator_get();
	if( r7 == NULL ) hl_null_access();
	hxd_impl_Allocator_onContextLost(r7);
	r8 = r0->mem;
	if( r8 == NULL ) hl_null_access();
	h3d_impl_MemoryManager_onContextLost(r8);
	goto label$5eb80ee_11_40;
	label$5eb80ee_11_20:
	r8 = (h3d__impl__MemoryManager)hl_alloc_obj(&t$h3d_impl_MemoryManager);
	r9 = r0->driver;
	h3d_impl_MemoryManager_new(r8,r9);
	r0->mem = r8;
	r8 = r0->mem;
	if( r8 == NULL ) hl_null_access();
	h3d_impl_MemoryManager_init(r8);
	r10 = (h3d__mat__Texture)hl_alloc_obj(&t$h3d_mat_Texture);
	r5 = 0;
	r11 = 0;
	r14 = &t$h3d_mat_TextureFlags;
	r15 = 1;
	r13 = hl_alloc_array(r14,r15);
	r16 = (venum*)g$h3d_mat_TextureFlags_NoAlloc;
	r15 = 0;
	((venum**)(r13 + 1))[r15] = r16;
	r12 = hl_types_ArrayObj_alloc(r13);
	r17 = NULL;
	h3d_mat_Texture_new(r10,r5,r11,r12,r17);
	r0->nullTexture = r10;
	label$5eb80ee_11_40:
	r9 = r0->driver;
	if( r9 == NULL ) hl_null_access();
	r18 = (venum*)g$6181a89;
	r4 = ((bool (*)(h3d__impl__Driver,venum*))r9->$type->vobj_proto[0])(r9,r18);
	r0->hardware = r4;
	r4 = r0->debug;
	r4 = h3d_Engine_set_debug(r0,r4);
	r4 = r0->fullScreen;
	r4 = h3d_Engine_set_fullScreen(r0,r4);
	r5 = r0->width;
	r11 = r0->height;
	h3d_Engine_resize(r0,r5,r11);
	if( !r1 ) goto label$5eb80ee_11_57;
	r19 = r0->onContextLost;
	if( r19 == NULL ) hl_null_access();
	r19->hasValue ? ((void (*)(vdynamic*))r19->fun)((vdynamic*)r19->value) : ((void (*)(void))r19->fun)();
	goto label$5eb80ee_11_60;
	label$5eb80ee_11_57:
	r19 = r0->onReady;
	if( r19 == NULL ) hl_null_access();
	r19->hasValue ? ((void (*)(vdynamic*))r19->fun)((vdynamic*)r19->value) : ((void (*)(void))r19->fun)();
	label$5eb80ee_11_60:
	r4 = true;
	r0->ready = r4;
	return;
}

void h3d_Engine_onContextLost(h3d__Engine r0) {
	return;
}

void h3d_Engine_onReady(h3d__Engine r0) {
	return;
}

void h3d_Engine_onWindowResize(h3d__Engine r0) {
	bool r2;
	hxd__Window r5;
	vclosure *r8;
	h3d__impl__Driver r3;
	int r4, r6, r7;
	r2 = r0->autoResize;
	if( !r2 ) goto label$5eb80ee_14_20;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r2 = ((bool (*)(h3d__impl__Driver))r3->$type->vobj_proto[3])(r3);
	if( r2 ) goto label$5eb80ee_14_20;
	r5 = r0->window;
	if( r5 == NULL ) hl_null_access();
	r4 = hxd_Window_get_width(r5);
	r5 = r0->window;
	if( r5 == NULL ) hl_null_access();
	r6 = hxd_Window_get_height(r5);
	r7 = r0->width;
	if( r4 != r7 ) goto label$5eb80ee_14_16;
	r7 = r0->height;
	if( r6 == r7 ) goto label$5eb80ee_14_17;
	label$5eb80ee_14_16:
	h3d_Engine_resize(r0,r4,r6);
	label$5eb80ee_14_17:
	r8 = r0->onResized;
	if( r8 == NULL ) hl_null_access();
	r8->hasValue ? ((void (*)(vdynamic*))r8->fun)((vdynamic*)r8->value) : ((void (*)(void))r8->fun)();
	label$5eb80ee_14_20:
	return;
}

bool h3d_Engine_set_fullScreen(h3d__Engine r0,bool r1) {
	venum *r4;
	bool r2;
	hxd__Window r6;
	h3d__impl__MemoryManager r3;
	int r5;
	r0->fullScreen = r1;
	r3 = r0->mem;
	if( !r3 ) goto label$5eb80ee_15_13;
	r4 = (venum*)g$hxd_SystemValue_IsWindowed;
	r2 = hxd_System_getValue(r4);
	if( !r2 ) goto label$5eb80ee_15_13;
	r6 = r0->window;
	if( r6 == NULL ) hl_null_access();
	if( !r1 ) goto label$5eb80ee_15_11;
	r5 = 2;
	goto label$5eb80ee_15_12;
	label$5eb80ee_15_11:
	r5 = 0;
	label$5eb80ee_15_12:
	r5 = hxd_Window_set_displayMode(r6,r5);
	label$5eb80ee_15_13:
	return r1;
}

void h3d_Engine_onResized(h3d__Engine r0) {
	return;
}

void h3d_Engine_resize(h3d__Engine r0,int r1,int r2) {
	bool r6;
	h3d__impl__Driver r7;
	int r4, r5;
	r5 = 32;
	if( r1 >= r5 ) goto label$5eb80ee_17_4;
	r4 = 32;
	r1 = r4;
	label$5eb80ee_17_4:
	r5 = 32;
	if( r2 >= r5 ) goto label$5eb80ee_17_8;
	r4 = 32;
	r2 = r4;
	label$5eb80ee_17_8:
	r0->width = r1;
	r0->height = r2;
	r7 = r0->driver;
	if( r7 == NULL ) hl_null_access();
	r6 = ((bool (*)(h3d__impl__Driver))r7->$type->vobj_proto[3])(r7);
	if( r6 ) goto label$5eb80ee_17_17;
	r7 = r0->driver;
	if( r7 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,int,int))r7->$type->vobj_proto[8])(r7,r1,r2);
	label$5eb80ee_17_17:
	return;
}

bool h3d_Engine_begin(h3d__Engine r0) {
	h3d___Engine__TargetTmp r5;
	bool r2;
	hxd__$Timer r8;
	double r10;
	vdynamic *r9, *r11, *r12;
	h3d__impl__Driver r3;
	h3d__mat__Texture r6, r7;
	int r4;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r2 = ((bool (*)(h3d__impl__Driver))r3->$type->vobj_proto[3])(r3);
	if( !r2 ) goto label$5eb80ee_18_6;
	r2 = false;
	return r2;
	label$5eb80ee_18_6:
	r2 = true;
	r0->inRender = r2;
	r4 = 0;
	r0->drawTriangles = r4;
	r4 = 0;
	r0->shaderSwitches = r4;
	r4 = 0;
	r0->drawCalls = r4;
	r5 = NULL;
	r0->targetStack = r5;
	r6 = r0->currentTargetTex;
	r7 = NULL;
	if( r6 != r7 ) goto label$5eb80ee_18_21;
	r2 = false;
	goto label$5eb80ee_18_22;
	label$5eb80ee_18_21:
	r2 = true;
	label$5eb80ee_18_22:
	r0->needFlushTarget = r2;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r8 = (hxd__$Timer)g$_hxd_Timer;
	r4 = r8->frameCount;
	((void (*)(h3d__impl__Driver,int))r3->$type->vobj_proto[4])(r3,r4);
	r9 = r0->backgroundColor;
	if( !r9 ) goto label$5eb80ee_18_37;
	r9 = r0->backgroundColor;
	r4 = 1;
	r10 = (double)r4;
	r11 = hl_alloc_dynamic(&t$_f64);
	r11->v.d = r10;
	r4 = 0;
	r12 = hl_alloc_dynamic(&t$_i32);
	r12->v.i = r4;
	h3d_Engine_clear(r0,r9,r11,r12);
	label$5eb80ee_18_37:
	r2 = true;
	return r2;
}

void h3d_Engine_end(h3d__Engine r0) {
	bool r1;
	h3d__impl__Driver r3;
	r1 = false;
	r0->inRender = r1;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver))r3->$type->vobj_proto[24])(r3);
	return;
}

h3d__mat__Texture h3d_Engine_getCurrentTarget(h3d__Engine r0) {
	h3d___Engine__TargetTmp r1;
	hl__types__ArrayObj r5;
	vdynamic *r3;
	varray *r8;
	int r6, r7;
	h3d__mat__Texture r2, r4;
	r1 = r0->targetStack;
	if( r1 ) goto label$5eb80ee_20_4;
	r2 = NULL;
	return r2;
	label$5eb80ee_20_4:
	r1 = r0->targetStack;
	if( r1 == NULL ) hl_null_access();
	r2 = r1->_hx_t;
	r4 = r0->nullTexture;
	if( r2 != r4 ) goto label$5eb80ee_20_22;
	r1 = r0->targetStack;
	if( r1 == NULL ) hl_null_access();
	r5 = r1->textures;
	if( r5 == NULL ) hl_null_access();
	r6 = 0;
	r7 = r5->length;
	if( ((unsigned)r6) < ((unsigned)r7) ) goto label$5eb80ee_20_18;
	r2 = NULL;
	goto label$5eb80ee_20_21;
	label$5eb80ee_20_18:
	r8 = r5->array;
	r3 = ((vdynamic**)(r8 + 1))[r6];
	r2 = (h3d__mat__Texture)r3;
	label$5eb80ee_20_21:
	return r2;
	label$5eb80ee_20_22:
	r1 = r0->targetStack;
	if( r1 == NULL ) hl_null_access();
	r2 = r1->_hx_t;
	return r2;
}

void h3d_Engine_pushTarget(h3d__Engine r0,h3d__mat__Texture r1,int* r2,int* r3,venum* r4) {
	h3d___Engine__TargetTmp r8, r10, r11;
	venum *r7;
	int r5, r6;
	if( r2 ) goto label$5eb80ee_21_3;
	r5 = 0;
	goto label$5eb80ee_21_4;
	label$5eb80ee_21_3:
	r5 = *r2;
	label$5eb80ee_21_4:
	if( r3 ) goto label$5eb80ee_21_7;
	r6 = 0;
	goto label$5eb80ee_21_8;
	label$5eb80ee_21_7:
	r6 = *r3;
	label$5eb80ee_21_8:
	if( r4 ) goto label$5eb80ee_21_11;
	r7 = (venum*)g$h3d_DepthBinding_ReadWrite;
	r4 = r7;
	label$5eb80ee_21_11:
	r8 = r0->targetTmp;
	if( r8 ) goto label$5eb80ee_21_18;
	r10 = (h3d___Engine__TargetTmp)hl_alloc_obj(&t$h3d__Engine_TargetTmp);
	r11 = r0->targetStack;
	h3d__Engine_TargetTmp_new(r10,r1,r11,r5,r6,r4);
	r8 = r10;
	goto label$5eb80ee_21_27;
	label$5eb80ee_21_18:
	if( r8 == NULL ) hl_null_access();
	r10 = r8->next;
	r0->targetTmp = r10;
	r8->_hx_t = r1;
	r11 = r0->targetStack;
	r8->next = r11;
	r8->mipLevel = r6;
	r8->layer = r5;
	r8->depthBinding = r4;
	label$5eb80ee_21_27:
	r0->targetStack = r8;
	h3d_Engine_updateNeedFlush(r0);
	return;
}

void h3d_Engine_updateNeedFlush(h3d__Engine r0) {
	h3d___Engine__TargetTmp r1;
	hl__types__ArrayObj r8;
	venum *r9, *r10;
	bool r3;
	int r6, r7;
	h3d__mat__Texture r4, r5;
	r1 = r0->targetStack;
	if( r1 ) goto label$5eb80ee_22_10;
	r4 = r0->currentTargetTex;
	r5 = NULL;
	if( r4 != r5 ) goto label$5eb80ee_22_7;
	r3 = false;
	goto label$5eb80ee_22_8;
	label$5eb80ee_22_7:
	r3 = true;
	label$5eb80ee_22_8:
	r0->needFlushTarget = r3;
	goto label$5eb80ee_22_29;
	label$5eb80ee_22_10:
	r4 = r0->currentTargetTex;
	if( r1 == NULL ) hl_null_access();
	r5 = r1->_hx_t;
	if( r4 != r5 ) goto label$5eb80ee_22_27;
	r6 = r0->currentTargetLayer;
	r7 = r1->layer;
	if( r6 != r7 ) goto label$5eb80ee_22_27;
	r6 = r0->currentTargetMip;
	r7 = r1->mipLevel;
	if( r6 != r7 ) goto label$5eb80ee_22_27;
	r8 = r1->textures;
	if( r8 ) goto label$5eb80ee_22_27;
	r9 = r0->currentDepthBinding;
	r10 = r1->depthBinding;
	if( r9 != r10 ) goto label$5eb80ee_22_27;
	r3 = false;
	goto label$5eb80ee_22_28;
	label$5eb80ee_22_27:
	r3 = true;
	label$5eb80ee_22_28:
	r0->needFlushTarget = r3;
	label$5eb80ee_22_29:
	return;
}

void h3d_Engine_pushDepth(h3d__Engine r0,h3d__mat__Texture r1) {
	venum *r5;
	int *r3, *r4;
	r3 = NULL;
	r4 = NULL;
	r5 = (venum*)g$h3d_DepthBinding_DepthOnly;
	h3d_Engine_pushTarget(r0,r1,r3,r4,r5);
	return;
}

void h3d_Engine_popTarget(h3d__Engine r0) {
	String r4;
	h3d___Engine__TargetTmp r1, r3, r7;
	hl__types__ArrayObj r6;
	h3d__mat__Texture r5;
	r1 = r0->targetStack;
	if( r1 ) goto label$5eb80ee_24_4;
	r4 = (String)s$6e0e621;
	hl_throw((vdynamic*)r4);
	label$5eb80ee_24_4:
	if( r1 == NULL ) hl_null_access();
	r3 = r1->next;
	r0->targetStack = r3;
	h3d_Engine_updateNeedFlush(r0);
	r5 = NULL;
	r1->_hx_t = r5;
	r6 = NULL;
	r1->textures = r6;
	r7 = r0->targetTmp;
	r1->next = r7;
	r0->targetTmp = r1;
	return;
}

void h3d_Engine_doFlushTarget(h3d__Engine r0) {
	h3d___Engine__TargetTmp r1;
	hl__types__ArrayObj r9;
	venum *r7, *r8;
	bool r13;
	int *r5, *r6;
	h3d__impl__Driver r3;
	int r10, r11, r12;
	h3d__mat__Texture r4;
	r1 = r0->targetStack;
	if( r1 ) goto label$5eb80ee_25_12;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r4 = NULL;
	r5 = NULL;
	r6 = NULL;
	r7 = NULL;
	((void (*)(h3d__impl__Driver,h3d__mat__Texture,int*,int*,venum*))r3->$type->vobj_proto[17])(r3,r4,r5,r6,r7);
	r4 = NULL;
	r0->currentTargetTex = r4;
	goto label$5eb80ee_25_46;
	label$5eb80ee_25_12:
	if( r1 == NULL ) hl_null_access();
	r7 = r1->depthBinding;
	r8 = (venum*)g$h3d_DepthBinding_DepthOnly;
	if( r7 != r8 ) goto label$5eb80ee_25_21;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r4 = r1->_hx_t;
	((void (*)(h3d__impl__Driver,h3d__mat__Texture))r3->$type->vobj_proto[19])(r3,r4);
	goto label$5eb80ee_25_38;
	label$5eb80ee_25_21:
	r9 = r1->textures;
	if( !r9 ) goto label$5eb80ee_25_29;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r9 = r1->textures;
	r7 = r1->depthBinding;
	((void (*)(h3d__impl__Driver,hl__types__ArrayObj,venum*))r3->$type->vobj_proto[18])(r3,r9,r7);
	goto label$5eb80ee_25_38;
	label$5eb80ee_25_29:
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r4 = r1->_hx_t;
	r10 = r1->layer;
	r5 = &r10;
	r11 = r1->mipLevel;
	r6 = &r11;
	r7 = r1->depthBinding;
	((void (*)(h3d__impl__Driver,h3d__mat__Texture,int*,int*,venum*))r3->$type->vobj_proto[17])(r3,r4,r5,r6,r7);
	label$5eb80ee_25_38:
	r4 = r1->_hx_t;
	r0->currentTargetTex = r4;
	r12 = r1->layer;
	r0->currentTargetLayer = r12;
	r12 = r1->mipLevel;
	r0->currentTargetMip = r12;
	r7 = r1->depthBinding;
	r0->currentDepthBinding = r7;
	label$5eb80ee_25_46:
	r13 = false;
	r0->needFlushTarget = r13;
	return;
}

void h3d_Engine_clear(h3d__Engine r0,vdynamic* r1,vdynamic* r2,vdynamic* r3) {
	bool r11;
	h3d__Vector4Impl r5;
	double r7, r10;
	h3d__impl__Driver r12;
	int r6, r8, r9;
	if( !r1 ) goto label$5eb80ee_26_32;
	r5 = r0->tmpVector;
	r6 = r1 ? r1->v.i : 0;
	if( r5 == NULL ) hl_null_access();
	r9 = 16;
	r8 = r6 >> r9;
	r9 = 255;
	r8 = r8 & r9;
	r7 = (double)r8;
	r10 = 255.;
	r7 = r7 / r10;
	r5->x = r7;
	r9 = 8;
	r8 = r6 >> r9;
	r9 = 255;
	r8 = r8 & r9;
	r7 = (double)r8;
	r10 = 255.;
	r7 = r7 / r10;
	r5->y = r7;
	r9 = 255;
	r8 = r6 & r9;
	r7 = (double)r8;
	r10 = 255.;
	r7 = r7 / r10;
	r5->z = r7;
	r9 = 24;
	r8 = ((unsigned)r6) >> r9;
	r7 = (double)r8;
	r10 = 255.;
	r7 = r7 / r10;
	r5->w = r7;
	label$5eb80ee_26_32:
	r11 = r0->needFlushTarget;
	if( !r11 ) goto label$5eb80ee_26_35;
	h3d_Engine_doFlushTarget(r0);
	label$5eb80ee_26_35:
	r12 = r0->driver;
	if( r12 == NULL ) hl_null_access();
	if( r1 ) goto label$5eb80ee_26_40;
	r5 = NULL;
	goto label$5eb80ee_26_41;
	label$5eb80ee_26_40:
	r5 = r0->tmpVector;
	label$5eb80ee_26_41:
	((void (*)(h3d__impl__Driver,h3d__Vector4Impl,vdynamic*,vdynamic*))r12->$type->vobj_proto[6])(r12,r5,r2,r3);
	return;
}

void h3d_Engine_setRenderZone(h3d__Engine r0,int* r1,int* r2,int* r3,int* r4) {
	bool r10;
	h3d__impl__Driver r11;
	int r5, r6, r7, r8;
	if( r1 ) goto label$5eb80ee_27_3;
	r5 = 0;
	goto label$5eb80ee_27_4;
	label$5eb80ee_27_3:
	r5 = *r1;
	label$5eb80ee_27_4:
	if( r2 ) goto label$5eb80ee_27_7;
	r6 = 0;
	goto label$5eb80ee_27_8;
	label$5eb80ee_27_7:
	r6 = *r2;
	label$5eb80ee_27_8:
	if( r3 ) goto label$5eb80ee_27_11;
	r7 = -1;
	goto label$5eb80ee_27_12;
	label$5eb80ee_27_11:
	r7 = *r3;
	label$5eb80ee_27_12:
	if( r4 ) goto label$5eb80ee_27_15;
	r8 = -1;
	goto label$5eb80ee_27_16;
	label$5eb80ee_27_15:
	r8 = *r4;
	label$5eb80ee_27_16:
	r10 = r0->needFlushTarget;
	if( !r10 ) goto label$5eb80ee_27_19;
	h3d_Engine_doFlushTarget(r0);
	label$5eb80ee_27_19:
	r11 = r0->driver;
	if( r11 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,int,int,int,int))r11->$type->vobj_proto[16])(r11,r5,r6,r7,r8);
	return;
}

bool h3d_Engine_render(h3d__Engine r0,vvirtual* r1) {
	bool r3;
	double r4, r5, r6, r7, r8;
	r3 = h3d_Engine_begin(r0);
	if( r3 ) goto label$5eb80ee_28_4;
	r3 = false;
	return r3;
	label$5eb80ee_28_4:
	if( r1 == NULL ) hl_null_access();
	if( hl_vfields(r1)[0] ) ((void (*)(vdynamic*,h3d__Engine))hl_vfields(r1)[0])(r1->value,r0); else {
		void *args[] = {r0};
		hl_dyn_call_obj(r1->value,&t$fun_d333c41,86600534/*render*/,args,NULL);
	}
	h3d_Engine_end(r0);
	r4 = hl_sys_time();
	r5 = r0->lastTime;
	r4 = r4 - r5;
	r5 = r0->lastTime;
	r5 = r5 + r4;
	r0->lastTime = r5;
	r6 = 0.;
	if( !(r6 < r4) ) goto label$5eb80ee_28_47;
	r5 = 1.;
	r5 = r5 / r4;
	r7 = r0->realFps;
	r8 = 2.;
	r7 = r7 * r8;
	if( !(r7 < r5) ) goto label$5eb80ee_28_26;
	r6 = r0->realFps;
	r7 = 2.;
	r6 = r6 * r7;
	r5 = r6;
	goto label$5eb80ee_28_34;
	label$5eb80ee_28_26:
	r7 = r0->realFps;
	r8 = 0.5;
	r7 = r7 * r8;
	if( !(r5 < r7) ) goto label$5eb80ee_28_34;
	r6 = r0->realFps;
	r7 = 0.5;
	r6 = r6 * r7;
	r5 = r6;
	label$5eb80ee_28_34:
	r7 = 0.5;
	r6 = r4 / r7;
	r8 = 0.2999999999999999889;
	if( !(r8 < r6) ) goto label$5eb80ee_28_40;
	r7 = 0.2999999999999999889;
	r6 = r7;
	label$5eb80ee_28_40:
	r7 = r0->realFps;
	r8 = 1.;
	r8 = r8 - r6;
	r7 = r7 * r8;
	r8 = r5 * r6;
	r7 = r7 + r8;
	r0->realFps = r7;
	label$5eb80ee_28_47:
	r3 = true;
	return r3;
}

void h3d_Engine_new(h3d__Engine r0) {
	haxe__ds__ObjectMap r2;
	venum *r18;
	bool r4;
	haxe__ds__IntMap r5;
	h3d__impl__GlDriver r21;
	hxd__Window r19;
	h3d__$Engine r17;
	h3d__Vector4Impl r6;
	double r7, r9, r11, r13, r20;
	vclosure *r1;
	int *r22;
	vdynamic *r16;
	double *r8, *r10, *r12, *r14;
	int r15;
	r1 = r0->onContextLost;
	if( r1 ) goto label$5eb80ee_29_4;
	r1 = hl_alloc_closure_ptr(&t$fun_9e7b219,h3d_Engine_onContextLost,r0);
	r0->onContextLost = r1;
	label$5eb80ee_29_4:
	r1 = r0->onReady;
	if( r1 ) goto label$5eb80ee_29_8;
	r1 = hl_alloc_closure_ptr(&t$fun_9e7b219,h3d_Engine_onReady,r0);
	r0->onReady = r1;
	label$5eb80ee_29_8:
	r1 = r0->onResized;
	if( r1 ) goto label$5eb80ee_29_12;
	r1 = hl_alloc_closure_ptr(&t$fun_9e7b219,h3d_Engine_onResized,r0);
	r0->onResized = r1;
	label$5eb80ee_29_12:
	r2 = (haxe__ds__ObjectMap)hl_alloc_obj(&t$haxe_ds_ObjectMap);
	haxe_ds_ObjectMap_new(r2);
	r0->resCache = r2;
	r4 = false;
	r0->ready = r4;
	r4 = false;
	r0->inRender = r4;
	r5 = (haxe__ds__IntMap)hl_alloc_obj(&t$haxe_ds_IntMap);
	haxe_ds_IntMap_new(r5);
	r0->textureColorCache = r5;
	r6 = (h3d__Vector4Impl)hl_alloc_obj(&t$h3d_Vector4Impl);
	r7 = 0.;
	r8 = &r7;
	r9 = 0.;
	r10 = &r9;
	r11 = 0.;
	r12 = &r11;
	r13 = 1.;
	r14 = &r13;
	h3d_Vector4Impl_new(r6,r8,r10,r12,r14);
	r0->tmpVector = r6;
	r15 = -16777216;
	r16 = hl_alloc_dynamic(&t$_i32);
	r16->v.i = r15;
	r0->backgroundColor = r16;
	r17 = (h3d__$Engine)g$_h3d_Engine;
	r4 = r17->SOFTWARE_DRIVER;
	r4 = !r4;
	r0->hardware = r4;
	r17 = (h3d__$Engine)g$_h3d_Engine;
	r15 = r17->ANTIALIASING;
	r0->antiAlias = r15;
	r4 = true;
	r0->autoResize = r4;
	r18 = (venum*)g$hxd_SystemValue_IsWindowed;
	r4 = hxd_System_getValue(r18);
	r4 = !r4;
	r4 = h3d_Engine_set_fullScreen(r0,r4);
	r19 = hxd_Window_getInstance();
	r0->window = r19;
	r20 = hxd_System_getDefaultFrameRate();
	r0->realFps = r20;
	r20 = hl_sys_time();
	r0->lastTime = r20;
	r19 = r0->window;
	if( r19 == NULL ) hl_null_access();
	r1 = hl_alloc_closure_ptr(&t$fun_9e7b219,h3d_Engine_onWindowResize,r0);
	hxd_Window_addResizeEvent(r19,r1);
	r21 = (h3d__impl__GlDriver)hl_alloc_obj(&t$h3d_impl_GlDriver);
	r15 = r0->antiAlias;
	r22 = &r15;
	h3d_impl_GlDriver_new(r21,r22);
	r0->driver = ((h3d__impl__Driver)r21);
	r17 = (h3d__$Engine)g$_h3d_Engine;
	r17->CURRENT = r0;
	return;
}

