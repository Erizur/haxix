// Generated by HLC 5.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <h3d/impl/TextureCache.h>
vdynamic* hl_types_ArrayObj_pop(hl__types__ArrayObj);
void h3d_mat_Texture_dispose(h3d__mat__Texture);
#include <h3d/mat/TextureFlags.h>
extern hl_type t$fun_7b48b4f;
bool h3d_mat_Texture_isDepth(h3d__mat__Texture);
void hl_types_ArrayObj___expand(hl__types__ArrayObj,int);
int String___compare(String,vdynamic*);
extern hl_type t$h3d_mat_TextureFlags;
#include <hl/natives.h>
extern venum* g$h3d_mat_TextureFlags_Target;
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
extern venum* g$h3d_mat_TextureFlags_Cube;
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
extern hl_type t$h3d_mat_Texture;
void h3d_mat_Texture_new(h3d__mat__Texture,int,int,hl__types__ArrayObj,venum*);
void hl_types_ArrayObj_insert(hl__types__ArrayObj,int,vdynamic*);
void h3d_mat_Texture_setName(h3d__mat__Texture,String);
#include <h3d/Engine.h>
#include <h3d/mat/Texture.h>
extern h3d__$Engine g$_h3d_Engine;
extern h3d__mat__$Texture g$_h3d_mat_Texture;
h3d__mat__Texture h3d_mat_Texture_getDefaultDepth(void);

void h3d_impl_TextureCache_begin(h3d__impl__TextureCache r0) {
	hl__types__ArrayObj r2;
	vdynamic *r4;
	h3d__mat__Texture r5;
	int r1, r3;
	label$97f2128_1_0:
	r2 = r0->cache;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->length;
	r3 = r0->position;
	if( r3 >= r1 ) goto label$97f2128_1_14;
	r2 = r0->cache;
	if( r2 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_pop(r2);
	r5 = (h3d__mat__Texture)r4;
	if( !r5 ) goto label$97f2128_1_13;
	if( r5 == NULL ) hl_null_access();
	h3d_mat_Texture_dispose(r5);
	label$97f2128_1_13:
	goto label$97f2128_1_0;
	label$97f2128_1_14:
	r1 = 0;
	r0->position = r1;
	return;
}

void h3d_impl_TextureCache_lookupTarget__$1() {
	return;
}

h3d__mat__Texture h3d_impl_TextureCache_lookupTarget(h3d__impl__TextureCache r0,String r1,int r2,int r3,venum* r4,bool r5) {
	String r23;
	vvirtual *r18, *r19;
	hl__types__ArrayObj r6, r26;
	hl_type *r24;
	venum *r21, *r25;
	bool r17, r22;
	vclosure *r20;
	vdynamic *r10;
	varray *r11;
	h3d__mat__Texture r9, r16;
	int r7, r8, r13, r14, r15;
	static vclosure cl$0 = { &t$fun_7b48b4f, h3d_impl_TextureCache_lookupTarget__$1, 0 };
	r6 = r0->cache;
	if( r6 == NULL ) hl_null_access();
	r7 = r0->position;
	r8 = r6->length;
	if( ((unsigned)r7) < ((unsigned)r8) ) goto label$97f2128_3_7;
	r9 = NULL;
	goto label$97f2128_3_10;
	label$97f2128_3_7:
	r11 = r6->array;
	r10 = ((vdynamic**)(r11 + 1))[r7];
	r9 = (h3d__mat__Texture)r10;
	label$97f2128_3_10:
	r7 = r0->position;
	r8 = 1;
	r7 = r7 + r8;
	r6 = r0->cache;
	if( r6 == NULL ) hl_null_access();
	r8 = r6->length;
	label$97f2128_3_16:
	if( r7 >= r8 ) goto label$97f2128_3_80;
	r13 = r7;
	++r7;
	r6 = r0->cache;
	if( r6 == NULL ) hl_null_access();
	r15 = r6->length;
	if( ((unsigned)r13) < ((unsigned)r15) ) goto label$97f2128_3_26;
	r16 = NULL;
	goto label$97f2128_3_29;
	label$97f2128_3_26:
	r11 = r6->array;
	r10 = ((vdynamic**)(r11 + 1))[r13];
	r16 = (h3d__mat__Texture)r10;
	label$97f2128_3_29:
	if( !r16 ) goto label$97f2128_3_79;
	if( r16 == NULL ) hl_null_access();
	r17 = h3d_mat_Texture_isDepth(r16);
	if( !r17 ) goto label$97f2128_3_40;
	r18 = r16->_hx_t;
	r19 = NULL;
	if( r18 == r19 || (r18 && r19 && r18->value && r19->value && r18->value == r19->value) ) goto label$97f2128_3_38;
	r17 = false;
	goto label$97f2128_3_39;
	label$97f2128_3_38:
	r17 = true;
	label$97f2128_3_39:
	goto label$97f2128_3_47;
	label$97f2128_3_40:
	r18 = r16->_hx_t;
	if( r18 ) goto label$97f2128_3_46;
	r20 = r16->realloc;
	if( r20 ) goto label$97f2128_3_46;
	r17 = true;
	goto label$97f2128_3_47;
	label$97f2128_3_46:
	r17 = false;
	label$97f2128_3_47:
	if( r17 ) goto label$97f2128_3_79;
	r14 = r16->width;
	if( r14 != r2 ) goto label$97f2128_3_79;
	r14 = r16->height;
	if( r14 != r3 ) goto label$97f2128_3_79;
	r21 = r16->format;
	if( r21 != r4 ) goto label$97f2128_3_79;
	r14 = r16->flags;
	r15 = 2;
	r14 = r14 & r15;
	r15 = 0;
	if( r14 != r15 ) goto label$97f2128_3_61;
	r22 = false;
	goto label$97f2128_3_62;
	label$97f2128_3_61:
	r22 = true;
	label$97f2128_3_62:
	if( r5 != r22 ) goto label$97f2128_3_79;
	r6 = r0->cache;
	if( r6 == NULL ) hl_null_access();
	r14 = r0->position;
	r15 = r6->length;
	if( ((unsigned)r14) < ((unsigned)r15) ) goto label$97f2128_3_69;
	hl_types_ArrayObj___expand(r6,r14);
	label$97f2128_3_69:
	r11 = r6->array;
	((h3d__mat__Texture*)(r11 + 1))[r14] = r16;
	r6 = r0->cache;
	if( r6 == NULL ) hl_null_access();
	r15 = r6->length;
	if( ((unsigned)r13) < ((unsigned)r15) ) goto label$97f2128_3_76;
	hl_types_ArrayObj___expand(r6,r13);
	label$97f2128_3_76:
	r11 = r6->array;
	((h3d__mat__Texture*)(r11 + 1))[r13] = r9;
	return r16;
	label$97f2128_3_79:
	goto label$97f2128_3_16;
	label$97f2128_3_80:
	if( !r9 ) goto label$97f2128_3_87;
	if( r9 == NULL ) hl_null_access();
	r23 = r9->name;
	if( r23 != r1 && (!r23 || !r1 || String___compare(r23,(vdynamic*)r1) != 0) ) goto label$97f2128_3_87;
	h3d_mat_Texture_dispose(r9);
	r16 = NULL;
	r9 = r16;
	label$97f2128_3_87:
	r24 = &t$h3d_mat_TextureFlags;
	r7 = 1;
	r11 = hl_alloc_array(r24,r7);
	r25 = (venum*)g$h3d_mat_TextureFlags_Target;
	r7 = 0;
	((venum**)(r11 + 1))[r7] = r25;
	r6 = hl_types_ArrayObj_alloc(r11);
	if( !r5 ) goto label$97f2128_3_98;
	if( r6 == NULL ) hl_null_access();
	r25 = (venum*)g$h3d_mat_TextureFlags_Cube;
	r7 = hl_types_ArrayObj_push(r6,((vdynamic*)r25));
	label$97f2128_3_98:
	r16 = (h3d__mat__Texture)hl_alloc_obj(&t$h3d_mat_Texture);
	h3d_mat_Texture_new(r16,r2,r3,r6,r4);
	r20 = &cl$0;
	r16->realloc = r20;
	if( !r9 ) goto label$97f2128_3_108;
	r26 = r0->cache;
	if( r26 == NULL ) hl_null_access();
	r7 = r0->position;
	hl_types_ArrayObj_insert(r26,r7,((vdynamic*)r16));
	goto label$97f2128_3_116;
	label$97f2128_3_108:
	r26 = r0->cache;
	if( r26 == NULL ) hl_null_access();
	r7 = r0->position;
	r8 = r26->length;
	if( ((unsigned)r7) < ((unsigned)r8) ) goto label$97f2128_3_114;
	hl_types_ArrayObj___expand(r26,r7);
	label$97f2128_3_114:
	r11 = r26->array;
	((h3d__mat__Texture*)(r11 + 1))[r7] = r16;
	label$97f2128_3_116:
	return r16;
}

h3d__mat__Texture h3d_impl_TextureCache_allocTarget(h3d__impl__TextureCache r0,String r1,int r2,int r3,bool* r4,venum* r5,bool* r6) {
	vvirtual *r19, *r20;
	hl__types__ArrayObj r9;
	venum *r16;
	bool r7, r8, r18, r22;
	vclosure *r21;
	vdynamic *r13;
	varray *r14;
	h3d__mat__Texture r12, r17, r23;
	int r10, r11;
	if( r4 ) goto label$97f2128_4_3;
	r7 = true;
	goto label$97f2128_4_4;
	label$97f2128_4_3:
	r7 = *r4;
	label$97f2128_4_4:
	if( r6 ) goto label$97f2128_4_7;
	r8 = false;
	goto label$97f2128_4_8;
	label$97f2128_4_7:
	r8 = *r6;
	label$97f2128_4_8:
	r9 = r0->cache;
	if( r9 == NULL ) hl_null_access();
	r10 = r0->position;
	r11 = r9->length;
	if( ((unsigned)r10) < ((unsigned)r11) ) goto label$97f2128_4_15;
	r12 = NULL;
	goto label$97f2128_4_18;
	label$97f2128_4_15:
	r14 = r9->array;
	r13 = ((vdynamic**)(r14 + 1))[r10];
	r12 = (h3d__mat__Texture)r13;
	label$97f2128_4_18:
	if( r5 ) goto label$97f2128_4_21;
	r16 = r0->defaultFormat;
	r5 = r16;
	label$97f2128_4_21:
	if( !r12 ) goto label$97f2128_4_55;
	if( r12 == NULL ) hl_null_access();
	r18 = h3d_mat_Texture_isDepth(r12);
	if( !r18 ) goto label$97f2128_4_32;
	r19 = r12->_hx_t;
	r20 = NULL;
	if( r19 == r20 || (r19 && r20 && r19->value && r20->value && r19->value == r20->value) ) goto label$97f2128_4_30;
	r18 = false;
	goto label$97f2128_4_31;
	label$97f2128_4_30:
	r18 = true;
	label$97f2128_4_31:
	goto label$97f2128_4_39;
	label$97f2128_4_32:
	r19 = r12->_hx_t;
	if( r19 ) goto label$97f2128_4_38;
	r21 = r12->realloc;
	if( r21 ) goto label$97f2128_4_38;
	r18 = true;
	goto label$97f2128_4_39;
	label$97f2128_4_38:
	r18 = false;
	label$97f2128_4_39:
	if( r18 ) goto label$97f2128_4_55;
	r10 = r12->width;
	if( r10 != r2 ) goto label$97f2128_4_55;
	r10 = r12->height;
	if( r10 != r3 ) goto label$97f2128_4_55;
	r16 = r12->format;
	if( r16 != r5 ) goto label$97f2128_4_55;
	r10 = r12->flags;
	r11 = 2;
	r10 = r10 & r11;
	r11 = 0;
	if( r10 != r11 ) goto label$97f2128_4_53;
	r22 = false;
	goto label$97f2128_4_54;
	label$97f2128_4_53:
	r22 = true;
	label$97f2128_4_54:
	if( r8 == r22 ) goto label$97f2128_4_57;
	label$97f2128_4_55:
	r17 = h3d_impl_TextureCache_lookupTarget(r0,r1,r2,r3,r5,r8);
	r12 = r17;
	label$97f2128_4_57:
	if( r12 == NULL ) hl_null_access();
	if( !r7 ) goto label$97f2128_4_61;
	r23 = r0->defaultDepthBuffer;
	goto label$97f2128_4_62;
	label$97f2128_4_61:
	r23 = NULL;
	label$97f2128_4_62:
	r12->depthBuffer = r23;
	h3d_mat_Texture_setName(r12,r1);
	r10 = r0->position;
	++r10;
	r0->position = r10;
	return r12;
}

void h3d_impl_TextureCache_new(h3d__impl__TextureCache r0,h3d__impl__RenderContext r1) {
	hl__types__ArrayObj r3;
	venum *r9;
	hl_type *r5;
	h3d__mat__$Texture r10;
	h3d__Engine r6;
	h3d__$Engine r7;
	h3d__mat__Texture r11;
	varray *r4;
	int r2;
	r2 = 0;
	r0->position = r2;
	r0->ctx = r1;
	r5 = &t$h3d_mat_Texture;
	r2 = 0;
	r4 = hl_alloc_array(r5,r2);
	r3 = hl_types_ArrayObj_alloc(r4);
	r0->cache = r3;
	r7 = (h3d__$Engine)g$_h3d_Engine;
	r6 = r7->CURRENT;
	r10 = (h3d__mat__$Texture)g$_h3d_mat_Texture;
	r9 = r10->nativeFormat;
	r0->defaultFormat = r9;
	r11 = h3d_mat_Texture_getDefaultDepth();
	r0->defaultDepthBuffer = r11;
	return;
}

