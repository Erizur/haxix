// Generated by HLC 5.0.0 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <hxd/MultiFormat.h>
#include <hxd/BufferFormat.h>
#include <hl/types/ArrayBytes_Int.h>
#include <haxe/iterators/ArrayIterator.h>
#include <hl/types/ArrayDyn.h>
#include <hxd/BufferInput.h>
#include <hl/natives.h>
hl__types__ArrayBytes_Int hl_types_ArrayBase_allocI32(vbyte*,int);
extern hl_type t$haxe_iterators_ArrayIterator;
extern hl_type t$hl_types_ArrayDyn;
extern hl_type t$hl_types_ArrayObj;
void haxe_iterators_ArrayIterator_new(haxe__iterators__ArrayIterator,hl__types__ArrayDyn);
hxd__BufferInput hxd_BufferFormat_getInput(hxd__BufferFormat,String);
int hxd_BufferFormat_calculateInputOffset(hxd__BufferFormat,String);
int hxd__BufferFormat_BufferMapping_Impl___new(int,int,int);
int hl_types_ArrayBytes_Int_push(hl__types__ArrayBytes_Int,int);
extern String s$Shader_buffer_;
String String___add__(String,String);
extern String s$_was_requested_with_;
String hxd__BufferFormat_InputFormat_Impl__toString(int);
extern String s$_but_found_with_;
extern String s$Missing_shader_buffer_;
void hl_types_ArrayObj___expand(hl__types__ArrayObj,int);
extern hl_type t$hl_types_ArrayBytes_Int;
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
extern hxd__$MultiFormat g$_hxd_MultiFormat;

hl__types__ArrayBytes_Int hxd_MultiFormat_makeMapping(hxd__MultiFormat r0,hxd__BufferFormat r1) {
	String r18, r23;
	hl__types__ArrayObj r7;
	bool r10, r22;
	haxe__iterators__ArrayIterator r6;
	hxd__BufferInput r12, r13, r17;
	hl__types__ArrayBytes_Int r2;
	hxd__BufferFormat r8;
	hl__types__ArrayDyn r9;
	vdynamic *r11;
	varray *r16;
	int r4, r14, r15, r19, r20, r21;
	vbyte *r3;
	r4 = 0;
	r3 = hl_alloc_bytes(r4);
	r4 = 0;
	r4 = 0;
	r2 = hl_types_ArrayBase_allocI32(r3,r4);
	r6 = (haxe__iterators__ArrayIterator)hl_alloc_obj(&t$haxe_iterators_ArrayIterator);
	if( r1 == NULL ) hl_null_access();
	r7 = r1->inputs;
	r9 = (hl__types__ArrayDyn)hl_dyn_castp(&r7,&t$hl_types_ArrayObj,&t$hl_types_ArrayDyn);
	haxe_iterators_ArrayIterator_new(r6,r9);
	label$b68c14a_1_10:
	if( r6 == NULL ) hl_null_access();
	r10 = ((bool (*)(haxe__iterators__ArrayIterator))r6->$type->vobj_proto[0])(r6);
	if( !r10 ) goto label$b68c14a_1_78;
	r11 = ((vdynamic* (*)(haxe__iterators__ArrayIterator))r6->$type->vobj_proto[1])(r6);
	r12 = (hxd__BufferInput)r11;
	r10 = false;
	r13 = NULL;
	r4 = 0;
	r7 = r0->formats;
	label$b68c14a_1_20:
	if( r7 == NULL ) hl_null_access();
	r15 = r7->length;
	if( r4 >= r15 ) goto label$b68c14a_1_54;
	r15 = r7->length;
	if( ((unsigned)r4) < ((unsigned)r15) ) goto label$b68c14a_1_28;
	r8 = NULL;
	goto label$b68c14a_1_31;
	label$b68c14a_1_28:
	r16 = r7->array;
	r11 = ((vdynamic**)(r16 + 1))[r4];
	r8 = (hxd__BufferFormat)r11;
	label$b68c14a_1_31:
	r14 = r4;
	++r4;
	if( r8 == NULL ) hl_null_access();
	if( r12 == NULL ) hl_null_access();
	r18 = r12->name;
	r17 = hxd_BufferFormat_getInput(r8,r18);
	if( !r17 ) goto label$b68c14a_1_53;
	r13 = r17;
	if( r17 == NULL ) hl_null_access();
	r19 = r17->type;
	r20 = r12->type;
	if( r19 == r20 ) goto label$b68c14a_1_44;
	goto label$b68c14a_1_20;
	label$b68c14a_1_44:
	r18 = r17->name;
	r19 = hxd_BufferFormat_calculateInputOffset(r8,r18);
	if( r2 == NULL ) hl_null_access();
	r21 = r17->precision;
	r20 = hxd__BufferFormat_BufferMapping_Impl___new(r14,r19,r21);
	r20 = hl_types_ArrayBytes_Int_push(r2,r20);
	r22 = true;
	r10 = r22;
	goto label$b68c14a_1_54;
	label$b68c14a_1_53:
	goto label$b68c14a_1_20;
	label$b68c14a_1_54:
	if( r10 ) goto label$b68c14a_1_77;
	if( !r13 ) goto label$b68c14a_1_72;
	r18 = (String)s$Shader_buffer_;
	if( r12 == NULL ) hl_null_access();
	r23 = r12->name;
	r18 = String___add__(r18,r23);
	r23 = (String)s$_was_requested_with_;
	r18 = String___add__(r18,r23);
	r4 = r12->type;
	r23 = hxd__BufferFormat_InputFormat_Impl__toString(r4);
	r18 = String___add__(r18,r23);
	r23 = (String)s$_but_found_with_;
	r18 = String___add__(r18,r23);
	if( r13 == NULL ) hl_null_access();
	r4 = r13->type;
	r23 = hxd__BufferFormat_InputFormat_Impl__toString(r4);
	r18 = String___add__(r18,r23);
	hl_throw((vdynamic*)r18);
	label$b68c14a_1_72:
	r18 = (String)s$Missing_shader_buffer_;
	if( r12 == NULL ) hl_null_access();
	r23 = r12->name;
	r18 = String___add__(r18,r23);
	hl_throw((vdynamic*)r18);
	label$b68c14a_1_77:
	goto label$b68c14a_1_10;
	label$b68c14a_1_78:
	r7 = r0->mappings;
	if( r7 == NULL ) hl_null_access();
	if( r1 == NULL ) hl_null_access();
	r4 = r1->uid;
	r14 = r7->length;
	if( ((unsigned)r4) < ((unsigned)r14) ) goto label$b68c14a_1_85;
	hl_types_ArrayObj___expand(r7,r4);
	label$b68c14a_1_85:
	r16 = r7->array;
	((hl__types__ArrayBytes_Int*)(r16 + 1))[r4] = r2;
	return r2;
}

void hxd_MultiFormat_new(hxd__MultiFormat r0,hl__types__ArrayObj r1) {
	hxd__$MultiFormat r6;
	hl__types__ArrayObj r2;
	hl_type *r4;
	int r5, r7;
	varray *r3;
	r4 = &t$hl_types_ArrayBytes_Int;
	r5 = 0;
	r3 = hl_alloc_array(r4,r5);
	r2 = hl_types_ArrayObj_alloc(r3);
	r0->mappings = r2;
	r6 = (hxd__$MultiFormat)g$_hxd_MultiFormat;
	r5 = r6->_UID;
	r7 = r5;
	++r5;
	r6->_UID = r5;
	r0->uid = r7;
	r0->formats = r1;
	return;
}

